


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > FilterFoundTabFragment</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">uk.trigpointing.android.mapping</a>
</div>

<h1>Coverage Summary for Class: FilterFoundTabFragment (uk.trigpointing.android.mapping)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FilterFoundTabFragment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/53)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/77)
  </span>
</td>
</tr>
  <tr>
    <td class="name">FilterFoundTabFragment$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/53)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/81)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package uk.trigpointing.android.mapping;
&nbsp;
&nbsp;import android.content.BroadcastReceiver;
&nbsp;import android.content.Context;
&nbsp;import android.content.Intent;
&nbsp;import android.content.IntentFilter;
&nbsp;import android.content.SharedPreferences;
&nbsp;import android.os.Bundle;
&nbsp;import androidx.localbroadcastmanager.content.LocalBroadcastManager;
&nbsp;import androidx.preference.PreferenceManager;
&nbsp;import android.view.LayoutInflater;
&nbsp;import android.view.View;
&nbsp;import android.view.ViewGroup;
&nbsp;import android.widget.RadioGroup;
&nbsp;
&nbsp;import androidx.annotation.NonNull;
&nbsp;import androidx.annotation.Nullable;
&nbsp;import androidx.fragment.app.Fragment;
&nbsp;
&nbsp;import uk.trigpointing.android.R;
&nbsp;
<b class="nc">&nbsp;public class FilterFoundTabFragment extends Fragment implements SharedPreferences.OnSharedPreferenceChangeListener {</b>
&nbsp;
&nbsp;    private RadioGroup filterFoundRadioGroup;
&nbsp;    private SharedPreferences prefs;
&nbsp;    private BroadcastReceiver filterChangeReceiver;
&nbsp;
&nbsp;    @Nullable
&nbsp;    @Override
&nbsp;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
<b class="nc">&nbsp;        View view = inflater.inflate(R.layout.tab_filter_found, container, false);</b>
&nbsp;        
<b class="nc">&nbsp;        filterFoundRadioGroup = view.findViewById(R.id.filterFoundRadioGroup);</b>
&nbsp;        
&nbsp;        // Initialize preferences
<b class="nc">&nbsp;        if (getActivity() != null) {</b>
<b class="nc">&nbsp;            prefs = PreferenceManager.getDefaultSharedPreferences(getActivity());</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Load current selection
<b class="nc">&nbsp;        loadCurrentSelection();</b>
&nbsp;        
&nbsp;        // Set up change listener
<b class="nc">&nbsp;        filterFoundRadioGroup.setOnCheckedChangeListener((group, checkedId) -&gt; {</b>
<b class="nc">&nbsp;            String selectedFound = getFoundFromRadioId(checkedId);</b>
<b class="nc">&nbsp;            saveFound(selectedFound);</b>
<b class="nc">&nbsp;            notifyLeafletMap(selectedFound);</b>
&nbsp;        });
&nbsp;        
<b class="nc">&nbsp;        return view;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onResume() {
<b class="nc">&nbsp;        super.onResume();</b>
&nbsp;        // Register preference change listener
<b class="nc">&nbsp;        if (prefs != null) {</b>
<b class="nc">&nbsp;            prefs.registerOnSharedPreferenceChangeListener(this);</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Set up broadcast receiver for filter changes
<b class="nc">&nbsp;        filterChangeReceiver = new BroadcastReceiver() {</b>
&nbsp;            @Override
&nbsp;            public void onReceive(Context context, Intent intent) {
<b class="nc">&nbsp;                String filterValue = intent.getStringExtra(&quot;filter_value&quot;);</b>
<b class="nc">&nbsp;                android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;Received broadcast: filter_value=&quot; + filterValue);</b>
<b class="nc">&nbsp;                loadCurrentSelection();</b>
&nbsp;            }
&nbsp;        };
&nbsp;        
<b class="nc">&nbsp;        if (getActivity() != null) {</b>
<b class="nc">&nbsp;            LocalBroadcastManager.getInstance(getActivity()).registerReceiver(</b>
&nbsp;                filterChangeReceiver, 
&nbsp;                new IntentFilter(&quot;FILTER_FOUND_CHANGED&quot;)
&nbsp;            );
&nbsp;        }
&nbsp;        
&nbsp;        // Reload filter state when returning to this fragment (e.g., after changing filter on nearest page)
<b class="nc">&nbsp;        loadCurrentSelection();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onPause() {
<b class="nc">&nbsp;        super.onPause();</b>
&nbsp;        // Unregister preference change listener
<b class="nc">&nbsp;        if (prefs != null) {</b>
<b class="nc">&nbsp;            prefs.unregisterOnSharedPreferenceChangeListener(this);</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Unregister broadcast receiver
<b class="nc">&nbsp;        if (filterChangeReceiver != null &amp;&amp; getActivity() != null) {</b>
<b class="nc">&nbsp;            LocalBroadcastManager.getInstance(getActivity()).unregisterReceiver(filterChangeReceiver);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void loadCurrentSelection() {
<b class="nc">&nbsp;        if (getActivity() == null || filterFoundRadioGroup == null || prefs == null) return;</b>
&nbsp;        
<b class="nc">&nbsp;        String currentFound = prefs.getString(&quot;leaflet_filter_found&quot;, &quot;all&quot;);</b>
<b class="nc">&nbsp;        android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;loadCurrentSelection: currentFound=&quot; + currentFound);</b>
&nbsp;        
<b class="nc">&nbsp;        int radioId = getRadioIdFromFound(currentFound);</b>
<b class="nc">&nbsp;        android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;loadCurrentSelection: radioId=&quot; + radioId);</b>
<b class="nc">&nbsp;        if (radioId != -1) {</b>
&nbsp;            // Temporarily disable listener to avoid triggering change events during programmatic update
<b class="nc">&nbsp;            filterFoundRadioGroup.setOnCheckedChangeListener(null);</b>
<b class="nc">&nbsp;            filterFoundRadioGroup.check(radioId);</b>
<b class="nc">&nbsp;            android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;loadCurrentSelection: checked radio &quot; + radioId);</b>
&nbsp;            // Re-enable listener
<b class="nc">&nbsp;            filterFoundRadioGroup.setOnCheckedChangeListener((group, checkedId) -&gt; {</b>
<b class="nc">&nbsp;                String selectedFound = getFoundFromRadioId(checkedId);</b>
<b class="nc">&nbsp;                saveFound(selectedFound);</b>
<b class="nc">&nbsp;                notifyLeafletMap(selectedFound);</b>
&nbsp;            });
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private String getFoundFromRadioId(int radioId) {
<b class="nc">&nbsp;        if (radioId == R.id.radioFoundAll) return &quot;all&quot;;</b>
<b class="nc">&nbsp;        if (radioId == R.id.radioFoundLogged) return &quot;logged&quot;;</b>
<b class="nc">&nbsp;        if (radioId == R.id.radioFoundNotLogged) return &quot;notlogged&quot;;</b>
<b class="nc">&nbsp;        if (radioId == R.id.radioFoundMarked) return &quot;marked&quot;;</b>
<b class="nc">&nbsp;        if (radioId == R.id.radioFoundUnsynced) return &quot;unsynced&quot;;</b>
<b class="nc">&nbsp;        return &quot;all&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    private int getRadioIdFromFound(String found) {
<b class="nc">&nbsp;        switch (found) {</b>
<b class="nc">&nbsp;            case &quot;all&quot;: return R.id.radioFoundAll;</b>
<b class="nc">&nbsp;            case &quot;logged&quot;: return R.id.radioFoundLogged;</b>
<b class="nc">&nbsp;            case &quot;notlogged&quot;: return R.id.radioFoundNotLogged;</b>
<b class="nc">&nbsp;            case &quot;marked&quot;: return R.id.radioFoundMarked;</b>
<b class="nc">&nbsp;            case &quot;unsynced&quot;: return R.id.radioFoundUnsynced;</b>
<b class="nc">&nbsp;            default: return R.id.radioFoundAll;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void saveFound(String found) {
<b class="nc">&nbsp;        if (getActivity() == null || prefs == null) return;</b>
&nbsp;        
<b class="nc">&nbsp;        SharedPreferences.Editor editor = prefs.edit();</b>
<b class="nc">&nbsp;        editor.putString(&quot;leaflet_filter_found&quot;, found);</b>
&nbsp;        
&nbsp;        // Also update the Filter.FILTERRADIO values for synchronization with nearest page
<b class="nc">&nbsp;        int filterRadio = convertToFilterRadioValue(found);</b>
<b class="nc">&nbsp;        editor.putInt(&quot;filterRadio&quot;, filterRadio);</b>
&nbsp;        
&nbsp;        // Update filter text for display purposes
<b class="nc">&nbsp;        String filterText = getFilterTextFromFound(found);</b>
<b class="nc">&nbsp;        editor.putString(&quot;filterRadioText&quot;, filterText);</b>
&nbsp;        
<b class="nc">&nbsp;        editor.apply();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void notifyLeafletMap(String found) {
<b class="nc">&nbsp;        if (getActivity() instanceof LeafletMapActivity) {</b>
<b class="nc">&nbsp;            ((LeafletMapActivity) getActivity()).updateFilterFound(found);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Convert leaflet filter values to FilterFoundActivity radio values for synchronization
&nbsp;     */
&nbsp;    private int convertToFilterRadioValue(String found) {
<b class="nc">&nbsp;        switch (found) {</b>
<b class="nc">&nbsp;            case &quot;all&quot;: return 0;      // filterAll</b>
<b class="nc">&nbsp;            case &quot;logged&quot;: return 1;   // filterLogged</b>
<b class="nc">&nbsp;            case &quot;notlogged&quot;: return 2; // filterNotLogged</b>
<b class="nc">&nbsp;            case &quot;marked&quot;: return 3;   // filterMarked</b>
<b class="nc">&nbsp;            case &quot;unsynced&quot;: return 4; // filterUnsynced</b>
<b class="nc">&nbsp;            default: return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Get display text for filter option
&nbsp;     */
&nbsp;    private String getFilterTextFromFound(String found) {
<b class="nc">&nbsp;        switch (found) {</b>
<b class="nc">&nbsp;            case &quot;all&quot;: return &quot;Logged or not&quot;;</b>
<b class="nc">&nbsp;            case &quot;logged&quot;: return &quot;Logged&quot;;</b>
<b class="nc">&nbsp;            case &quot;notlogged&quot;: return &quot;Not Logged&quot;;</b>
<b class="nc">&nbsp;            case &quot;marked&quot;: return &quot;Marked&quot;;</b>
<b class="nc">&nbsp;            case &quot;unsynced&quot;: return &quot;Unsynced&quot;;</b>
<b class="nc">&nbsp;            default:         return &quot;Logged or not&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) {
<b class="nc">&nbsp;        android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;onSharedPreferenceChanged: key=&quot; + key);</b>
&nbsp;        // Listen for changes to the leaflet_filter_found preference
<b class="nc">&nbsp;        if (&quot;leaflet_filter_found&quot;.equals(key)) {</b>
<b class="nc">&nbsp;            android.util.Log.d(&quot;FilterFoundTabFragment&quot;, &quot;Detected leaflet_filter_found change, reloading selection&quot;);</b>
&nbsp;            // Reload the filter selection when preferences change
<b class="nc">&nbsp;            loadCurrentSelection();</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-08-25 13:52</div>
</div>
</body>
</html>
