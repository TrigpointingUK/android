


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LatLon</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">uk.trigpointing.android.types</a>
</div>

<h1>Coverage Summary for Class: LatLon (uk.trigpointing.android.types)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LatLon</td>
<td class="coverageStat">
  <span class="percent">
    81.5%
  </span>
  <span class="absValue">
    (22/27)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    68.6%
  </span>
  <span class="absValue">
    (35/51)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    93.3%
  </span>
  <span class="absValue">
    (251/269)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LatLon$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LatLon$UNITS</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    82.8%
  </span>
  <span class="absValue">
    (24/29)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    68.6%
  </span>
  <span class="absValue">
    (35/51)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    93.4%
  </span>
  <span class="absValue">
    (253/271)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package uk.trigpointing.android.types;
&nbsp;
&nbsp;import java.io.Serializable;
&nbsp;import java.util.regex.Matcher;
&nbsp;import java.util.regex.Pattern;
&nbsp;
&nbsp;import android.location.Location;
&nbsp;
&nbsp;public class LatLon implements Serializable {
&nbsp;	/**
&nbsp;	 * Class to handle WGS location
&nbsp;	 *
&nbsp;	 *  
&nbsp;	 * calcOSGB and getOSGB.. methods borrow heavily from: http://www.jstott.me.uk/jcoord/ (c) 2006 Jonathan Stott
&nbsp;	 * 
&nbsp;	 */
&nbsp;	
&nbsp;	private static final long serialVersionUID = 7608960556753529471L;
&nbsp;	//private static final String TAG = &quot;LatLon&quot;;
&nbsp;	private Double mLat;
&nbsp;	private Double mLon;
&nbsp;	private Double mEastings;
&nbsp;	private Double mNorthings;
&nbsp;
&nbsp;	private static final double AIRYMAJ = 6377563.396;
&nbsp;	private static final double AIRYMIN = 6356256.909;
&nbsp;	private static final double AIRYECC = ((AIRYMAJ * AIRYMAJ) - (AIRYMIN * AIRYMIN)) / (AIRYMAJ * AIRYMAJ);
&nbsp;		
&nbsp;	private static final double WGSMAJ = 6378137.000;
&nbsp;	private static final double WGSMIN = 6356752.3141;
&nbsp;	private static final double WGSECC = ((WGSMAJ * WGSMAJ) - (WGSMIN * WGSMIN)) / (WGSMAJ * WGSMAJ);
&nbsp;		
<b class="fc">&nbsp;	public enum UNITS {KM, MILES, METRES, YARDS}</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;    public LatLon() {</b>
&nbsp;	}
<b class="fc">&nbsp;	public LatLon(Double lat, Double lon) {</b>
<b class="fc">&nbsp;		this.mLat=lat;</b>
<b class="fc">&nbsp;		this.mLon=lon;</b>
&nbsp;	}
<b class="nc">&nbsp;	public LatLon(Location loc) {</b>
<b class="nc">&nbsp;		this.mLat = loc.getLatitude();</b>
<b class="nc">&nbsp;		this.mLon = loc.getLongitude();</b>
&nbsp;	}	
<b class="nc">&nbsp;	public LatLon(Long eastings, Long northings) {</b>
<b class="nc">&nbsp;		this.mEastings = Double.valueOf(eastings);</b>
<b class="nc">&nbsp;		this.mNorthings = Double.valueOf(northings);</b>
<b class="nc">&nbsp;		calcWGS();</b>
&nbsp;	}
<b class="fc">&nbsp;	public LatLon(String osgbGridref) throws IllegalArgumentException {</b>
<b class="fc">&nbsp;        if (osgbGridref == null || osgbGridref.equals(&quot;&quot;)) {</b>
<b class="fc">&nbsp;			throw new IllegalArgumentException(&quot;&quot;);</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        osgbGridref = Pattern.compile(&quot;\\s&quot;).matcher(osgbGridref).replaceAll(&quot;&quot;);</b>
<b class="fc">&nbsp;        Pattern pattern = Pattern.compile(&quot;(\\w\\w)(\\d{6,10})&quot;, Pattern.CASE_INSENSITIVE);</b>
<b class="fc">&nbsp;		Matcher matcher = pattern.matcher(osgbGridref.toUpperCase());</b>
&nbsp;		
<b class="fc">&nbsp;		if (!matcher.matches()) {</b>
<b class="fc">&nbsp;			throw new IllegalArgumentException(&quot;Gridref : invalid format&quot;);</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		String gridletters = matcher.group(1);</b>
<b class="fc">&nbsp;		String digits = matcher.group(2);</b>
&nbsp;		Long eastings;
&nbsp;		Long northings;
<b class="pc">&nbsp;		switch (digits.length()) {</b>
&nbsp;		case 6:
<b class="fc">&nbsp;			eastings =  100 * Long.parseLong(digits.substring(0, digits.length()/2));</b>
<b class="fc">&nbsp;			northings = 100 * Long.parseLong(digits.substring(digits.length()/2));</b>
&nbsp;			break;
&nbsp;		case 8:
<b class="fc">&nbsp;			eastings =   10 * Long.parseLong(digits.substring(0, digits.length()/2));</b>
<b class="fc">&nbsp;			northings =  10 * Long.parseLong(digits.substring(digits.length()/2));</b>
&nbsp;			break;	
&nbsp;		case 10:	
<b class="fc">&nbsp;			eastings =        Long.parseLong(digits.substring(0, digits.length()/2));</b>
<b class="fc">&nbsp;			northings =       Long.parseLong(digits.substring(digits.length()/2));</b>
&nbsp;			break;
&nbsp;		default:
<b class="nc">&nbsp;			throw new IllegalArgumentException(&quot;Gridref : incorrect digit count&quot;);				</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		int big = gridletters.charAt(0) - &#39;A&#39;;</b>
<b class="pc">&nbsp;		if (big &gt; 7) {big --;} // no I</b>
<b class="fc">&nbsp;		int bigr   = big / 5;</b>
<b class="fc">&nbsp;		int bigc   = big % 5;</b>
&nbsp;
<b class="fc">&nbsp;		int small  = gridletters.charAt(1) - &#39;A&#39;;</b>
<b class="pc">&nbsp;		if (small &gt; 7) {small --;} // no I</b>
<b class="fc">&nbsp;		int smallr = small / 5;</b>
<b class="fc">&nbsp;		int smallc  = small % 5;</b>
&nbsp;		
<b class="fc">&nbsp;		eastings += 500000* (bigc-2) + 100000*(smallc);</b>
<b class="fc">&nbsp;		northings += 500000L * (3-bigr) + 100000*(4-smallr);</b>
&nbsp;
<b class="fc">&nbsp;		mEastings = Double.valueOf(eastings);</b>
<b class="fc">&nbsp;		mNorthings = Double.valueOf(northings);</b>
<b class="fc">&nbsp;		calcWGS();</b>
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;	
&nbsp;	public Double getLat() {
<b class="fc">&nbsp;		return mLat;</b>
&nbsp;	}
&nbsp;	public void setLat(Double mLat) {
<b class="fc">&nbsp;		this.mLat = mLat;</b>
<b class="fc">&nbsp;		mEastings = null; mNorthings = null;</b>
&nbsp;	}
&nbsp;	public Double getLon() {
<b class="fc">&nbsp;		return mLon;</b>
&nbsp;	}
&nbsp;	public void setLon(Double mLon) {
<b class="fc">&nbsp;		this.mLon = mLon;</b>
<b class="fc">&nbsp;		mEastings = null; mNorthings = null;</b>
&nbsp;	}
&nbsp;	
&nbsp;	
&nbsp;
&nbsp;	
&nbsp;	
&nbsp;	public Long getEastings() {
<b class="fc">&nbsp;		return mEastings.longValue();</b>
&nbsp;	}
&nbsp;	public Long getNorthings() {
<b class="fc">&nbsp;		return mNorthings.longValue();</b>
&nbsp;	}
&nbsp;	
&nbsp;	
&nbsp;	public Double distanceTo(Double lat, Double lon, UNITS units) {
&nbsp;		Double d;
<b class="fc">&nbsp;		double radius = 0;</b>
<b class="pc">&nbsp;		if (lat == null || lon == null) {return null;}</b>
<b class="fc">&nbsp;		double lat1 = Math.toRadians(mLat);</b>
<b class="fc">&nbsp;		double lat2 = Math.toRadians(lat);</b>
<b class="fc">&nbsp;		double lon1 = Math.toRadians(mLon);</b>
<b class="fc">&nbsp;		double lon2 = Math.toRadians(lon);</b>
&nbsp;
<b class="pc">&nbsp;		switch (units) {</b>
&nbsp;		case KM:
<b class="fc">&nbsp;			radius = 6371;</b>
&nbsp;			break;
&nbsp;		case MILES:
<b class="fc">&nbsp;			radius = 3959;</b>
&nbsp;			break;
&nbsp;		case METRES:
<b class="fc">&nbsp;			radius = 6371000;</b>
&nbsp;			break;
&nbsp;		case YARDS:
<b class="nc">&nbsp;			radius = 3959*1760;</b>
&nbsp;			break;
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		d = Math.acos(Math.sin(lat1)*Math.sin(lat2) + </b>
<b class="fc">&nbsp;					  Math.cos(lat1)*Math.cos(lat2) *</b>
<b class="fc">&nbsp;					  Math.cos(lon2-lon1) ) * radius;</b>
<b class="fc">&nbsp;		return d;</b>
&nbsp;	}
&nbsp;	
&nbsp;	public Double distanceTo(LatLon l, UNITS u) {
<b class="fc">&nbsp;		return distanceTo(l.mLat, l.mLon, u);</b>
&nbsp;	}
&nbsp;
&nbsp;	public Double distanceTo(Location l, UNITS u) {
<b class="nc">&nbsp;		return distanceTo(l.getLatitude(), l.getLongitude(), u);</b>
&nbsp;	}
&nbsp;	
&nbsp;	public Double bearingTo(LatLon l) {
&nbsp;		Double b;
<b class="fc">&nbsp;		double lat1 = Math.toRadians(mLat);</b>
<b class="fc">&nbsp;		double lat2 = Math.toRadians(l.mLat);</b>
<b class="fc">&nbsp;		double lon1 = Math.toRadians(mLon);</b>
<b class="fc">&nbsp;		double lon2 = Math.toRadians(l.mLon);</b>
&nbsp;		
<b class="fc">&nbsp;		double y = Math.sin(lon2-lon1) * Math.cos(lat2);</b>
<b class="fc">&nbsp;		double x = Math.cos(lat1) * Math.sin(lat2) -</b>
<b class="fc">&nbsp;		           Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2-lon1);</b>
<b class="fc">&nbsp;		b = Math.toDegrees( Math.atan2(y, x) );</b>
<b class="fc">&nbsp;		return b;</b>
&nbsp;	}
&nbsp;	
&nbsp; 	public Double bearingFrom(Double lat, Double lon) {
&nbsp;		Double b;
<b class="pc">&nbsp;		if (lat == null || lon == null) {return null;}</b>
<b class="fc">&nbsp;		double lat2 = Math.toRadians(mLat);</b>
<b class="fc">&nbsp;		double lat1 = Math.toRadians(lat);</b>
<b class="fc">&nbsp;		double lon2 = Math.toRadians(mLon);</b>
<b class="fc">&nbsp;		double lon1 = Math.toRadians(lon);</b>
&nbsp;		
<b class="fc">&nbsp;		double y = Math.sin(lon2-lon1) * Math.cos(lat2);</b>
<b class="fc">&nbsp;		double x = Math.cos(lat1) * Math.sin(lat2) -</b>
<b class="fc">&nbsp;		           Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2-lon1);</b>
<b class="fc">&nbsp;		b = Math.toDegrees( Math.atan2(y, x) );</b>
&nbsp;		
&nbsp;		// Normalize bearing to 0-360 degrees
<b class="pc">&nbsp;		if (b &lt; 0) {</b>
<b class="nc">&nbsp;			b += 360.0;</b>
&nbsp;		}
&nbsp;		
<b class="fc">&nbsp;		return b;</b>
&nbsp;	}
&nbsp; 	
&nbsp; 	public Double bearingFrom(LatLon l) {
<b class="fc">&nbsp; 		return bearingFrom(l.mLat, l.mLon);</b>
&nbsp;	}
&nbsp;	
&nbsp; 	public Double bearingFrom(Location l) {
<b class="nc">&nbsp; 		return bearingFrom(l.getLatitude(), l.getLongitude());</b>
&nbsp; 	}
&nbsp; 	
&nbsp;	public String toString() {
<b class="fc">&nbsp;	    return String.format(&quot;(%2.2f,%3.2f)&quot;, mLat, mLon);</b>
&nbsp;	}	
&nbsp;	
&nbsp;	public String getWGS() {
<b class="fc">&nbsp;		int latDegs = (int) Math.floor(Math.abs(mLat));</b>
<b class="fc">&nbsp;		Double latMins = (Math.abs(mLat)-latDegs)*60;</b>
<b class="fc">&nbsp;		int lonDegs = (int) Math.floor(Math.abs(mLon));</b>
<b class="fc">&nbsp;		Double LonMins = (Math.abs(mLon)-lonDegs)*60;</b>
<b class="pc">&nbsp;		return String.format(&quot;%s%02d %02.3f  %s%03d %02.3f&quot;, mLat&gt;0?&quot;N&quot;:&quot;S&quot;, latDegs, latMins, mLon&gt;0?&quot;E&quot;:&quot;W&quot;, lonDegs, LonMins );</b>
&nbsp;	}
&nbsp;	
&nbsp;	public String getOSGB10 () {
<b class="fc">&nbsp;		if (mEastings == null) {calcOSGB();}</b>
&nbsp;		
<b class="fc">&nbsp;		int hundredkmE = (int) Math.floor(mEastings / 100000);</b>
<b class="fc">&nbsp;		int hundredkmN = (int) Math.floor(mNorthings / 100000);</b>
&nbsp;		String firstLetter;
<b class="pc">&nbsp;		if (hundredkmN &lt; 5) {</b>
<b class="nc">&nbsp;			if (hundredkmE &lt; 5) {</b>
<b class="nc">&nbsp;				firstLetter = &quot;S&quot;;</b>
&nbsp;			} else {
<b class="nc">&nbsp;				firstLetter = &quot;T&quot;;</b>
&nbsp;			}
<b class="pc">&nbsp;		} else if (hundredkmN &lt; 10) {</b>
<b class="pc">&nbsp;			if (hundredkmE &lt; 5) {</b>
<b class="fc">&nbsp;				firstLetter = &quot;N&quot;;</b>
&nbsp;			} else {
<b class="nc">&nbsp;				firstLetter = &quot;O&quot;;</b>
&nbsp;			}
&nbsp;		} else {
<b class="nc">&nbsp;			firstLetter = &quot;H&quot;;</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		int index = 65 + ((4 - (hundredkmN % 5)) * 5) + (hundredkmE % 5);</b>
&nbsp;		// int ti = index;
<b class="pc">&nbsp;		if (index &gt;= 73)</b>
<b class="fc">&nbsp;			index++;</b>
<b class="fc">&nbsp;		String secondLetter = Character.toString((char) index);</b>
&nbsp;
<b class="fc">&nbsp;		int e = (int) Math.floor(mEastings - (100000 * hundredkmE));</b>
<b class="fc">&nbsp;		int n = (int) Math.floor(mNorthings - (100000 * hundredkmN));</b>
&nbsp;
<b class="fc">&nbsp;		return String.format(&quot;%s%s %05d %05d&quot;, firstLetter, secondLetter, e, n);</b>
&nbsp;	}
&nbsp;	
&nbsp;	public String getOSGB6 () {
<b class="fc">&nbsp;		String gridref10 = getOSGB10();</b>
<b class="fc">&nbsp;		String gridref6 = gridref10.substring(0,2) + gridref10.substring(3,6) + gridref10.substring(9,12);</b>
<b class="fc">&nbsp;		return gridref6;</b>
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;	
&nbsp;	private void calcOSGB() {
<b class="fc">&nbsp;		double a = WGSMAJ;</b>
<b class="fc">&nbsp;		double eSquared = WGSECC;</b>
<b class="fc">&nbsp;		double phi = Math.toRadians(mLat);</b>
<b class="fc">&nbsp;		double lambda = Math.toRadians(mLon);</b>
<b class="fc">&nbsp;		double v = a / (Math.sqrt(1 - eSquared * sinSquared(phi)));</b>
<b class="fc">&nbsp;		double H = 0; // height</b>
<b class="fc">&nbsp;		double x = (v + H) * Math.cos(phi) * Math.cos(lambda);</b>
<b class="fc">&nbsp;		double y = (v + H) * Math.cos(phi) * Math.sin(lambda);</b>
<b class="fc">&nbsp;		double z = ((1 - eSquared) * v + H) * Math.sin(phi);</b>
&nbsp;
<b class="fc">&nbsp;		double tx = -446.448;</b>
<b class="fc">&nbsp;		double ty = 125.157;</b>
<b class="fc">&nbsp;		double tz = -542.060;</b>
<b class="fc">&nbsp;		double s = 0.0000204894;</b>
<b class="fc">&nbsp;		double rx = Math.toRadians(-0.00004172222);</b>
<b class="fc">&nbsp;		double ry = Math.toRadians(-0.00006861111);</b>
<b class="fc">&nbsp;		double rz = Math.toRadians(-0.00023391666);</b>
&nbsp;
<b class="fc">&nbsp;		double xB = tx + (x * (1 + s)) + (-rx * y) + (ry * z);</b>
<b class="fc">&nbsp;		double yB = ty + (rz * x) + (y * (1 + s)) + (-rx * z);</b>
<b class="fc">&nbsp;		double zB = tz + (-ry * x) + (rx * y) + (z * (1 + s));</b>
&nbsp;
<b class="fc">&nbsp;		a = AIRYMAJ;</b>
<b class="fc">&nbsp;		eSquared = AIRYECC;</b>
&nbsp;
<b class="fc">&nbsp;		double lambdaB = Math.toDegrees(Math.atan(yB / xB));</b>
<b class="fc">&nbsp;		double p = Math.sqrt((xB * xB) + (yB * yB));</b>
<b class="fc">&nbsp;		double phiN = Math.atan(zB / (p * (1 - eSquared)));</b>
<b class="fc">&nbsp;		for (int i = 1; i &lt; 10; i++) {</b>
<b class="fc">&nbsp;			v = a / (Math.sqrt(1 - eSquared * sinSquared(phiN)));</b>
<b class="fc">&nbsp;			double phiN1 = Math.atan((zB + (eSquared * v * Math.sin(phiN))) / p);</b>
<b class="fc">&nbsp;			phiN = phiN1;</b>
&nbsp;		}
&nbsp;
<b class="fc">&nbsp;		double phiB = Math.toDegrees(phiN);</b>
&nbsp;
<b class="fc">&nbsp;		double osgbLat = phiB;</b>
<b class="fc">&nbsp;		double osgbLon = lambdaB;</b>
&nbsp;
&nbsp;		
&nbsp;		
<b class="fc">&nbsp;		double OSGB_F0 = 0.9996012717;</b>
<b class="fc">&nbsp;		double N0 = -100000.0;</b>
<b class="fc">&nbsp;		double E0 = 400000.0;</b>
<b class="fc">&nbsp;		double phi0 = Math.toRadians(49.0);</b>
<b class="fc">&nbsp;		double lambda0 = Math.toRadians(-2.0);</b>
<b class="fc">&nbsp;		a = AIRYMAJ;</b>
<b class="fc">&nbsp;		double b = AIRYMIN;</b>
<b class="fc">&nbsp;		eSquared = AIRYECC;</b>
<b class="fc">&nbsp;		phi = Math.toRadians(osgbLat);</b>
<b class="fc">&nbsp;		lambda = Math.toRadians(osgbLon);</b>
<b class="fc">&nbsp;		double n = (a - b) / (a + b);</b>
<b class="fc">&nbsp;		v = a * OSGB_F0 * Math.pow(1.0 - eSquared * sinSquared(phi), -0.5);</b>
<b class="fc">&nbsp;		double rho =</b>
&nbsp;			a * OSGB_F0 * (1.0 - eSquared)
<b class="fc">&nbsp;			* Math.pow(1.0 - eSquared * sinSquared(phi), -1.5);</b>
<b class="fc">&nbsp;		double etaSquared = (v / rho) - 1.0;</b>
<b class="fc">&nbsp;		double M =</b>
&nbsp;			(b * OSGB_F0)
&nbsp;			* (((1 + n + ((5.0 / 4.0) * n * n) + ((5.0 / 4.0) * n * n * n)) * (phi - phi0))
&nbsp;					- (((3 * n) + (3 * n * n) + ((21.0 / 8.0) * n * n * n))
<b class="fc">&nbsp;							* Math.sin(phi - phi0) * Math.cos(phi + phi0))</b>
&nbsp;							+ ((((15.0 / 8.0) * n * n) + ((15.0 / 8.0) * n * n * n))
<b class="fc">&nbsp;									* Math.sin(2.0 * (phi - phi0)) * Math</b>
<b class="fc">&nbsp;									.cos(2.0 * (phi + phi0))) - (((35.0 / 24.0) * n * n * n)</b>
<b class="fc">&nbsp;											* Math.sin(3.0 * (phi - phi0)) * Math.cos(3.0 * (phi + phi0))));</b>
<b class="fc">&nbsp;		double I = M + N0;</b>
<b class="fc">&nbsp;		double II = (v / 2.0) * Math.sin(phi) * Math.cos(phi);</b>
<b class="fc">&nbsp;		double III =</b>
<b class="fc">&nbsp;			(v / 24.0) * Math.sin(phi) * Math.pow(Math.cos(phi), 3.0)</b>
<b class="fc">&nbsp;			* (5.0 - tanSquared(phi) + (9.0 * etaSquared));</b>
<b class="fc">&nbsp;		double IIIA =</b>
&nbsp;			(v / 720.0)
<b class="fc">&nbsp;			* Math.sin(phi)</b>
<b class="fc">&nbsp;			* Math.pow(Math.cos(phi), 5.0)</b>
<b class="fc">&nbsp;			* (61.0 - (58.0 * tanSquared(phi)) + Math.pow(Math.tan(phi),</b>
&nbsp;					4.0));
<b class="fc">&nbsp;		double IV = v * Math.cos(phi);</b>
<b class="fc">&nbsp;		double V =</b>
<b class="fc">&nbsp;			(v / 6.0) * Math.pow(Math.cos(phi), 3.0)</b>
<b class="fc">&nbsp;			* ((v / rho) - tanSquared(phi));</b>
<b class="fc">&nbsp;		double VI =</b>
&nbsp;			(v / 120.0)
<b class="fc">&nbsp;			* Math.pow(Math.cos(phi), 5.0)</b>
<b class="fc">&nbsp;			* (5.0 - (18.0 * tanSquared(phi))</b>
<b class="fc">&nbsp;					+ (Math.pow(Math.tan(phi), 4.0)) + (14 * etaSquared) - (58 * tanSquared(phi) * etaSquared));</b>
&nbsp;
<b class="fc">&nbsp;		mNorthings =</b>
<b class="fc">&nbsp;			I + (II * Math.pow(lambda - lambda0, 2.0))</b>
<b class="fc">&nbsp;			+ (III * Math.pow(lambda - lambda0, 4.0))</b>
<b class="fc">&nbsp;			+ (IIIA * Math.pow(lambda - lambda0, 6.0));</b>
<b class="fc">&nbsp;		mEastings =</b>
<b class="fc">&nbsp;			E0 + (IV * (lambda - lambda0)) + (V * Math.pow(lambda - lambda0, 3.0))</b>
<b class="fc">&nbsp;			+ (VI * Math.pow(lambda - lambda0, 5.0));</b>
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;	
&nbsp;	
&nbsp;	// convert eastings, northings to latitude, longitude
&nbsp;	public void calcWGS() {
&nbsp;		// convert eastings, northings to Airy latitude longitude
<b class="fc">&nbsp;	    double OSGB_F0 = 0.9996012717;</b>
<b class="fc">&nbsp;	    double N0 = -100000.0;</b>
<b class="fc">&nbsp;	    double E0 = 400000.0;</b>
<b class="fc">&nbsp;	    double phi0 = Math.toRadians(49.0);</b>
<b class="fc">&nbsp;	    double lambda0 = Math.toRadians(-2.0);</b>
<b class="fc">&nbsp;	    double a = AIRYMAJ;</b>
<b class="fc">&nbsp;	    double b = AIRYMIN;</b>
<b class="fc">&nbsp;	    double eSquared = AIRYECC;</b>
<b class="fc">&nbsp;	    double phi = 0.0;</b>
<b class="fc">&nbsp;	    double lambda = 0.0;</b>
<b class="fc">&nbsp;	    double E = mEastings;</b>
<b class="fc">&nbsp;	    double N = mNorthings;</b>
<b class="fc">&nbsp;	    double n = (a - b) / (a + b);</b>
<b class="fc">&nbsp;	    double M = 0.0;</b>
<b class="fc">&nbsp;	    double phiPrime = ((N - N0) / (a * OSGB_F0)) + phi0;</b>
&nbsp;	    do {
<b class="fc">&nbsp;	      M = (b * OSGB_F0)</b>
&nbsp;	          * (((1 + n + ((5.0 / 4.0) * n * n) + ((5.0 / 4.0) * n * n * n)) * (phiPrime - phi0))
&nbsp;	              - (((3 * n) + (3 * n * n) + ((21.0 / 8.0) * n * n * n))
<b class="fc">&nbsp;	                  * Math.sin(phiPrime - phi0) * Math.cos(phiPrime + phi0))</b>
&nbsp;	              + ((((15.0 / 8.0) * n * n) + ((15.0 / 8.0) * n * n * n))
<b class="fc">&nbsp;	                  * Math.sin(2.0 * (phiPrime - phi0)) * Math</b>
<b class="fc">&nbsp;	                  .cos(2.0 * (phiPrime + phi0))) - (((35.0 / 24.0) * n * n * n)</b>
<b class="fc">&nbsp;	              * Math.sin(3.0 * (phiPrime - phi0)) * Math</b>
<b class="fc">&nbsp;	              .cos(3.0 * (phiPrime + phi0))));</b>
<b class="fc">&nbsp;	      phiPrime += (N - N0 - M) / (a * OSGB_F0);</b>
<b class="fc">&nbsp;	    } while ((N - N0 - M) &gt;= 0.001);</b>
<b class="fc">&nbsp;	    double v = a * OSGB_F0</b>
<b class="fc">&nbsp;	        * Math.pow(1.0 - eSquared * sinSquared(phiPrime), -0.5);</b>
<b class="fc">&nbsp;	    double rho = a * OSGB_F0 * (1.0 - eSquared)</b>
<b class="fc">&nbsp;	        * Math.pow(1.0 - eSquared * sinSquared(phiPrime), -1.5);</b>
<b class="fc">&nbsp;	    double etaSquared = (v / rho) - 1.0;</b>
<b class="fc">&nbsp;	    double VII = Math.tan(phiPrime) / (2 * rho * v);</b>
<b class="fc">&nbsp;	    double VIII = (Math.tan(phiPrime) / (24.0 * rho * Math.pow(v, 3.0)))</b>
<b class="fc">&nbsp;	        * (5.0 + (3.0 * tanSquared(phiPrime)) + etaSquared - (9.0 * tanSquared(phiPrime) * etaSquared));</b>
<b class="fc">&nbsp;	    double IX = (Math.tan(phiPrime) / (720.0 * rho * Math.pow(v, 5.0)))</b>
<b class="fc">&nbsp;	        * (61.0 + (90.0 * tanSquared(phiPrime)) + (45.0 * tanSquared(phiPrime) * tanSquared(phiPrime)));</b>
<b class="fc">&nbsp;	    double X = sec(phiPrime) / v;</b>
<b class="fc">&nbsp;	    double XI = (sec(phiPrime) / (6.0 * v * v * v))</b>
<b class="fc">&nbsp;	        * ((v / rho) + (2 * tanSquared(phiPrime)));</b>
<b class="fc">&nbsp;	    double XII = (sec(phiPrime) / (120.0 * Math.pow(v, 5.0)))</b>
<b class="fc">&nbsp;	        * (5.0 + (28.0 * tanSquared(phiPrime)) + (24.0 * tanSquared(phiPrime) * tanSquared(phiPrime)));</b>
<b class="fc">&nbsp;	    double XIIA = (sec(phiPrime) / (5040.0 * Math.pow(v, 7.0)))</b>
<b class="fc">&nbsp;	        * (61.0 + (662.0 * tanSquared(phiPrime))</b>
<b class="fc">&nbsp;	            + (1320.0 * tanSquared(phiPrime) * tanSquared(phiPrime)) + (720.0</b>
<b class="fc">&nbsp;	            * tanSquared(phiPrime) * tanSquared(phiPrime) * tanSquared(phiPrime)));</b>
<b class="fc">&nbsp;	    phi = phiPrime - (VII * Math.pow(E - E0, 2.0))</b>
<b class="fc">&nbsp;	        + (VIII * Math.pow(E - E0, 4.0)) - (IX * Math.pow(E - E0, 6.0));</b>
<b class="fc">&nbsp;	    lambda = lambda0 + (X * (E - E0)) - (XI * Math.pow(E - E0, 3.0))</b>
<b class="fc">&nbsp;	        + (XII * Math.pow(E - E0, 5.0)) - (XIIA * Math.pow(E - E0, 7.0));</b>
&nbsp;		
&nbsp;		
&nbsp;		// change datum to WGS84
<b class="fc">&nbsp;	    double v1 = a / (Math.sqrt(1 - eSquared * sinSquared(phi)));</b>
<b class="fc">&nbsp;	    double H = 0; // height</b>
<b class="fc">&nbsp;	    double x = (v1 + H) * Math.cos(phi) * Math.cos(lambda);</b>
<b class="fc">&nbsp;	    double y = (v1 + H) * Math.cos(phi) * Math.sin(lambda);</b>
<b class="fc">&nbsp;	    double z = ((1 - eSquared) * v1 + H) * Math.sin(phi);</b>
&nbsp;
<b class="fc">&nbsp;	    double tx = 446.448;</b>
<b class="fc">&nbsp;	    double ty = -125.157;</b>
<b class="fc">&nbsp;	    double tz = 542.060;</b>
<b class="fc">&nbsp;	    double s = -0.0000204894;</b>
<b class="fc">&nbsp;	    double rx = Math.toRadians(0.00004172222);</b>
<b class="fc">&nbsp;	    double ry = Math.toRadians(0.00006861111);</b>
<b class="fc">&nbsp;	    double rz = Math.toRadians(0.00023391666);</b>
&nbsp;
<b class="fc">&nbsp;	    double xB = tx + (x * (1 + s)) + (-rx * y) + (ry * z);</b>
<b class="fc">&nbsp;	    double yB = ty + (rz * x) + (y * (1 + s)) + (-rx * z);</b>
<b class="fc">&nbsp;	    double zB = tz + (-ry * x) + (rx * y) + (z * (1 + s));</b>
&nbsp;
<b class="fc">&nbsp;	    a = WGSMAJ;</b>
<b class="fc">&nbsp;	    eSquared = WGSECC;</b>
&nbsp;
<b class="fc">&nbsp;	    double lambdaB = Math.toDegrees(Math.atan(yB / xB));</b>
<b class="fc">&nbsp;	    double p = Math.sqrt((xB * xB) + (yB * yB));</b>
<b class="fc">&nbsp;	    double phiN = Math.atan(zB / (p * (1 - eSquared)));</b>
<b class="fc">&nbsp;	    for (int i = 1; i &lt; 10; i++) {</b>
<b class="fc">&nbsp;	      v1 = a / (Math.sqrt(1 - eSquared * sinSquared(phiN)));</b>
<b class="fc">&nbsp;	      double phiN1 = Math.atan((zB + (eSquared * v1 * Math.sin(phiN))) / p);</b>
<b class="fc">&nbsp;	      phiN = phiN1;</b>
&nbsp;	    }
&nbsp;
<b class="fc">&nbsp;	    double phiB = Math.toDegrees(phiN);</b>
&nbsp;
<b class="fc">&nbsp;	    mLat = phiB;</b>
<b class="fc">&nbsp;	    mLon = lambdaB;</b>
&nbsp;
&nbsp;
&nbsp;	}
&nbsp;
&nbsp;	protected static double sinSquared(double x) {
<b class="fc">&nbsp;		return Math.sin(x) * Math.sin(x);</b>
&nbsp;	}
&nbsp;	protected static double tanSquared(double x) {
<b class="fc">&nbsp;		return Math.tan(x) * Math.tan(x);</b>
&nbsp;	}
&nbsp;	protected static double sec(double x) {
<b class="fc">&nbsp;	    return 1.0 / Math.cos(x);</b>
&nbsp;	}
&nbsp;
&nbsp;
&nbsp;	
&nbsp;	}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-08-25 13:52</div>
</div>
</body>
</html>
