


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > PhotoManager</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">uk.trigpointing.android.logging</a>
</div>

<h1>Coverage Summary for Class: PhotoManager (uk.trigpointing.android.logging)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">PhotoManager</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
</tr>
  <tr>
    <td class="name">PhotoManager$Companion</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$deletePhoto$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$deletePhoto$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$PhotoMetadata</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$processPhoto$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/45)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$processSelectedPhotos$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$processSelectedPhotos$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$processSelectedPhotos$1$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$processSelectedPhotos$1$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$updatePhotoMetadata$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhotoManager$updatePhotoMetadata$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/135)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package uk.trigpointing.android.logging
&nbsp;
&nbsp;import android.app.Activity
&nbsp;import android.content.Context
&nbsp;import android.content.Intent
&nbsp;import android.graphics.Bitmap
&nbsp;import android.net.Uri
&nbsp;import android.os.Build
&nbsp;import android.provider.MediaStore
&nbsp;import android.util.Log
&nbsp;import androidx.activity.result.ActivityResultLauncher
&nbsp;import androidx.activity.result.PickVisualMediaRequest
&nbsp;import androidx.activity.result.contract.ActivityResultContracts
&nbsp;import androidx.appcompat.app.AlertDialog
&nbsp;import androidx.fragment.app.Fragment
&nbsp;import androidx.fragment.app.FragmentActivity
&nbsp;import kotlinx.coroutines.CoroutineScope
&nbsp;import kotlinx.coroutines.Dispatchers
&nbsp;import kotlinx.coroutines.launch
&nbsp;import kotlinx.coroutines.withContext
&nbsp;import uk.trigpointing.android.DbHelper
&nbsp;import uk.trigpointing.android.R
&nbsp;import uk.trigpointing.android.common.FileCache
&nbsp;import uk.trigpointing.android.common.Utils
&nbsp;import uk.trigpointing.android.types.PhotoSubject
&nbsp;import uk.trigpointing.android.types.TrigPhoto
&nbsp;import java.io.File
&nbsp;import java.io.FileNotFoundException
&nbsp;import java.io.IOException
&nbsp;
&nbsp;/**
&nbsp; * Unified photo management system for the TrigpointingUK app.
&nbsp; * Handles photo selection, metadata, storage, and display.
&nbsp; */
<b class="nc">&nbsp;class PhotoManager(</b>
<b class="nc">&nbsp;    private val context: Context,</b>
<b class="nc">&nbsp;    private val scope: CoroutineScope</b>
&nbsp;) {
<b class="nc">&nbsp;    private val TAG = &quot;PhotoManager&quot;</b>
<b class="nc">&nbsp;    private val db = DbHelper(context)</b>
&nbsp;    
&nbsp;    companion object {
&nbsp;        const val MAX_PHOTO_SIZE = 1024 // Max dimension for full photo
&nbsp;        const val THUMB_SIZE = 200 // Thumbnail size
&nbsp;        const val JPEG_QUALITY = 85 // JPEG compression quality
&nbsp;        
&nbsp;        // Photo metadata dialog result codes
&nbsp;        const val RESULT_PHOTO_SAVED = 1001
&nbsp;        const val RESULT_PHOTO_DELETED = 1002
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Data class for photo metadata
&nbsp;     */
&nbsp;    data class PhotoMetadata(
<b class="nc">&nbsp;        val subject: PhotoSubject = PhotoSubject.TRIGPOINT,</b>
<b class="nc">&nbsp;        val caption: String = &quot;&quot;,</b>
<b class="nc">&nbsp;        val isPublic: Boolean = true</b>
&nbsp;    )
&nbsp;    
&nbsp;    /**
&nbsp;     * Process selected photos from picker
&nbsp;     */
&nbsp;    fun processSelectedPhotos(
&nbsp;        trigId: Long,
&nbsp;        uris: List&lt;Uri&gt;,
&nbsp;        onPhotoAdded: (Long) -&gt; Unit,
&nbsp;        onComplete: () -&gt; Unit,
&nbsp;        onError: (String) -&gt; Unit
&nbsp;    ) {
<b class="nc">&nbsp;        Log.d(TAG, &quot;processSelectedPhotos() called with trigId=$trigId, ${uris.size} URIs&quot;)</b>
<b class="nc">&nbsp;        scope.launch {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Log.d(TAG, &quot;Opening database for photo processing&quot;)</b>
<b class="nc">&nbsp;                db.open()</b>
<b class="nc">&nbsp;                var successCount = 0</b>
&nbsp;                
<b class="nc">&nbsp;                Log.d(TAG, &quot;Starting to process ${uris.size} photos&quot;)</b>
<b class="nc">&nbsp;                for ((index, uri) in uris.withIndex()) {</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Processing photo ${index + 1}/${uris.size}: $uri&quot;)</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        val photoId = processPhoto(trigId, uri)</b>
<b class="nc">&nbsp;                        if (photoId != null) {</b>
<b class="nc">&nbsp;                            successCount++</b>
<b class="nc">&nbsp;                            Log.i(TAG, &quot;Photo processed successfully with ID: $photoId&quot;)</b>
<b class="nc">&nbsp;                            withContext(Dispatchers.Main) {</b>
<b class="nc">&nbsp;                                Log.d(TAG, &quot;Calling onPhotoAdded callback for photo ID: $photoId&quot;)</b>
<b class="nc">&nbsp;                                onPhotoAdded(photoId)</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            Log.w(TAG, &quot;processPhoto returned null for URI: $uri&quot;)</b>
&nbsp;                        }
&nbsp;                    } catch (e: Exception) {
<b class="nc">&nbsp;                        Log.e(TAG, &quot;Failed to process photo at index $index: ${uri}&quot;, e)</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;                Log.d(TAG, &quot;Photo processing complete. Success count: $successCount out of ${uris.size}&quot;)</b>
<b class="nc">&nbsp;                withContext(Dispatchers.Main) {</b>
<b class="nc">&nbsp;                    if (successCount &gt; 0) {</b>
<b class="nc">&nbsp;                        Log.i(TAG, &quot;Calling onComplete callback - $successCount photos processed successfully&quot;)</b>
<b class="nc">&nbsp;                        onComplete()</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        Log.e(TAG, &quot;No photos were processed successfully&quot;)</b>
<b class="nc">&nbsp;                        onError(&quot;Failed to process any photos&quot;)</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            } catch (e: Exception) {
<b class="nc">&nbsp;                Log.e(TAG, &quot;Error processing photos&quot;, e)</b>
<b class="nc">&nbsp;                withContext(Dispatchers.Main) {</b>
<b class="nc">&nbsp;                    Log.e(TAG, &quot;Calling onError callback with message: ${e.message}&quot;)</b>
<b class="nc">&nbsp;                    onError(&quot;Error: ${e.message}&quot;)</b>
&nbsp;                }
&nbsp;            } finally {
<b class="nc">&nbsp;                Log.d(TAG, &quot;Closing database after photo processing&quot;)</b>
<b class="nc">&nbsp;                db.close()</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Process a single photo URI
&nbsp;     */
<b class="nc">&nbsp;    private suspend fun processPhoto(trigId: Long, uri: Uri): Long? = withContext(Dispatchers.IO) {</b>
<b class="nc">&nbsp;        Log.d(TAG, &quot;processPhoto() called for URI: $uri, trigId: $trigId&quot;)</b>
&nbsp;        try {
&nbsp;            // Create database record
<b class="nc">&nbsp;            Log.d(TAG, &quot;Creating database record for photo...&quot;)</b>
<b class="nc">&nbsp;            val photoId = db.createPhoto(</b>
<b class="nc">&nbsp;                trigId, </b>
<b class="nc">&nbsp;                &quot;&quot;, // name - will be set in metadata dialog</b>
<b class="nc">&nbsp;                &quot;&quot;, // description - will be set in metadata dialog</b>
<b class="nc">&nbsp;                &quot;&quot;, // icon path - will be set below</b>
<b class="nc">&nbsp;                &quot;&quot;, // photo path - will be set below</b>
<b class="nc">&nbsp;                PhotoSubject.NOSUBJECT, </b>
<b class="nc">&nbsp;                1 // default to public</b>
&nbsp;            )
&nbsp;            
<b class="nc">&nbsp;            Log.i(TAG, &quot;Created photo record with ID: $photoId for trigId: $trigId&quot;)</b>
&nbsp;            
&nbsp;            // Process and save images
<b class="nc">&nbsp;            val cacheDir = FileCache(context, &quot;logphotos&quot;).cacheDir</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Cache directory: ${cacheDir.absolutePath}&quot;)</b>
&nbsp;            
<b class="nc">&nbsp;            val photoPath = File(cacheDir, &quot;${photoId}_I.jpg&quot;).absolutePath</b>
<b class="nc">&nbsp;            val thumbPath = File(cacheDir, &quot;${photoId}_T.jpg&quot;).absolutePath</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Photo will be saved to: $photoPath&quot;)</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Thumbnail will be saved to: $thumbPath&quot;)</b>
&nbsp;            
&nbsp;            // Decode and save images
<b class="nc">&nbsp;            Log.d(TAG, &quot;Decoding photo bitmap from URI...&quot;)</b>
<b class="nc">&nbsp;            val photoBitmap = Utils.decodeUri(context, uri, MAX_PHOTO_SIZE)</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Photo bitmap decoded: ${photoBitmap.width}x${photoBitmap.height}&quot;)</b>
&nbsp;            
<b class="nc">&nbsp;            Log.d(TAG, &quot;Decoding thumbnail bitmap from URI...&quot;)</b>
<b class="nc">&nbsp;            val thumbBitmap = Utils.decodeUri(context, uri, THUMB_SIZE)</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Thumbnail bitmap decoded: ${thumbBitmap.width}x${thumbBitmap.height}&quot;)</b>
&nbsp;            
<b class="nc">&nbsp;            Log.d(TAG, &quot;Saving photo bitmap to file...&quot;)</b>
<b class="nc">&nbsp;            Utils.saveBitmapToFile(photoPath, photoBitmap, JPEG_QUALITY)</b>
<b class="nc">&nbsp;            Log.d(TAG, &quot;Saving thumbnail bitmap to file...&quot;)</b>
<b class="nc">&nbsp;            Utils.saveBitmapToFile(thumbPath, thumbBitmap, 50)</b>
&nbsp;            
<b class="nc">&nbsp;            Log.i(TAG, &quot;Successfully saved photo files - Photo: $photoPath, Thumb: $thumbPath&quot;)</b>
&nbsp;            
&nbsp;            // Update database with file paths
<b class="nc">&nbsp;            Log.d(TAG, &quot;Updating database record with file paths...&quot;)</b>
<b class="nc">&nbsp;            val updateResult = db.updatePhoto(</b>
<b class="nc">&nbsp;                photoId,</b>
<b class="nc">&nbsp;                trigId,</b>
<b class="nc">&nbsp;                &quot;&quot;, // name</b>
<b class="nc">&nbsp;                &quot;&quot;, // description</b>
<b class="nc">&nbsp;                thumbPath,</b>
<b class="nc">&nbsp;                photoPath,</b>
<b class="nc">&nbsp;                PhotoSubject.NOSUBJECT,</b>
<b class="nc">&nbsp;                1 // public</b>
&nbsp;            )
<b class="nc">&nbsp;            Log.i(TAG, &quot;Database update result: $updateResult for photo ID: $photoId&quot;)</b>
&nbsp;            
<b class="nc">&nbsp;            Log.i(TAG, &quot;Photo processing completed successfully, returning photoId: $photoId&quot;)</b>
<b class="nc">&nbsp;            photoId</b>
&nbsp;        } catch (e: Exception) {
<b class="nc">&nbsp;            Log.e(TAG, &quot;Failed to process photo from URI: $uri&quot;, e)</b>
<b class="nc">&nbsp;            Log.e(TAG, &quot;Exception details: ${e.javaClass.simpleName}: ${e.message}&quot;)</b>
<b class="nc">&nbsp;            e.printStackTrace()</b>
<b class="nc">&nbsp;            null</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Show metadata dialog for a photo
&nbsp;     */
&nbsp;    fun showMetadataDialog(
&nbsp;        activity: FragmentActivity,
&nbsp;        photoId: Long,
&nbsp;        onSave: (PhotoMetadata) -&gt; Unit,
&nbsp;        onDelete: () -&gt; Unit
&nbsp;    ) {
<b class="nc">&nbsp;        val dialog = PhotoMetadataDialog.newInstance(photoId)</b>
<b class="nc">&nbsp;        dialog.setCallbacks(onSave, onDelete)</b>
<b class="nc">&nbsp;        dialog.show(activity.supportFragmentManager, &quot;photo_metadata&quot;)</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Update photo metadata in database
&nbsp;     */
&nbsp;    fun updatePhotoMetadata(
&nbsp;        photoId: Long,
&nbsp;        metadata: PhotoMetadata,
&nbsp;        onComplete: () -&gt; Unit
&nbsp;    ) {
<b class="nc">&nbsp;        scope.launch {</b>
&nbsp;            try {
<b class="nc">&nbsp;                db.open()</b>
<b class="nc">&nbsp;                val cursor = db.fetchPhoto(photoId)</b>
<b class="nc">&nbsp;                if (cursor != null &amp;&amp; cursor.moveToFirst()) {</b>
<b class="nc">&nbsp;                    val trigId = cursor.getLong(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_TRIG))</b>
<b class="nc">&nbsp;                    val iconPath = cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_ICON))</b>
<b class="nc">&nbsp;                    val photoPath = cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_PHOTO))</b>
&nbsp;                    cursor.close()
&nbsp;                    
<b class="nc">&nbsp;                    db.updatePhoto(</b>
<b class="nc">&nbsp;                        photoId,</b>
<b class="nc">&nbsp;                        trigId,</b>
<b class="nc">&nbsp;                        metadata.caption,</b>
<b class="nc">&nbsp;                        &quot;&quot;, // description not used in new design</b>
<b class="nc">&nbsp;                        iconPath,</b>
<b class="nc">&nbsp;                        photoPath,</b>
<b class="nc">&nbsp;                        metadata.subject,</b>
<b class="nc">&nbsp;                        if (metadata.isPublic) 1 else 0</b>
&nbsp;                    )
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;                withContext(Dispatchers.Main) {</b>
<b class="nc">&nbsp;                    onComplete()</b>
&nbsp;                }
&nbsp;            } catch (e: Exception) {
<b class="nc">&nbsp;                Log.e(TAG, &quot;Failed to update photo metadata&quot;, e)</b>
&nbsp;            } finally {
<b class="nc">&nbsp;                db.close()</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Delete a photo and its files
&nbsp;     */
&nbsp;    fun deletePhoto(
&nbsp;        photoId: Long,
&nbsp;        onComplete: () -&gt; Unit
&nbsp;    ) {
<b class="nc">&nbsp;        scope.launch {</b>
&nbsp;            try {
<b class="nc">&nbsp;                db.open()</b>
&nbsp;                
&nbsp;                // Get file paths before deleting from database
<b class="nc">&nbsp;                val cursor = db.fetchPhoto(photoId)</b>
<b class="nc">&nbsp;                if (cursor != null &amp;&amp; cursor.moveToFirst()) {</b>
<b class="nc">&nbsp;                    val iconPath = cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_ICON))</b>
<b class="nc">&nbsp;                    val photoPath = cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_PHOTO))</b>
&nbsp;                    cursor.close()
&nbsp;                    
&nbsp;                    // Delete files
<b class="nc">&nbsp;                    File(iconPath).delete()</b>
<b class="nc">&nbsp;                    File(photoPath).delete()</b>
&nbsp;                }
&nbsp;                
&nbsp;                // Delete from database
<b class="nc">&nbsp;                db.deletePhoto(photoId)</b>
&nbsp;                
<b class="nc">&nbsp;                withContext(Dispatchers.Main) {</b>
<b class="nc">&nbsp;                    onComplete()</b>
&nbsp;                }
&nbsp;            } catch (e: Exception) {
<b class="nc">&nbsp;                Log.e(TAG, &quot;Failed to delete photo&quot;, e)</b>
&nbsp;            } finally {
<b class="nc">&nbsp;                db.close()</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Get all photos for a trigpoint
&nbsp;     */
&nbsp;    fun getPhotosForTrigpoint(trigId: Long): List&lt;TrigPhoto&gt; {
<b class="nc">&nbsp;        val photos = mutableListOf&lt;TrigPhoto&gt;()</b>
&nbsp;        try {
<b class="nc">&nbsp;            db.open()</b>
<b class="nc">&nbsp;            val cursor = db.fetchPhotos(trigId)</b>
<b class="nc">&nbsp;            if (cursor != null &amp;&amp; cursor.moveToFirst()) {</b>
&nbsp;                do {
<b class="nc">&nbsp;                    val photo = TrigPhoto()</b>
<b class="nc">&nbsp;                    photo.setLogID(cursor.getLong(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_ID)))</b>
<b class="nc">&nbsp;                    photo.setIconURL(cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_ICON)))</b>
<b class="nc">&nbsp;                    photo.setPhotoURL(cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_PHOTO)))</b>
<b class="nc">&nbsp;                    photo.setName(cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_NAME)))</b>
<b class="nc">&nbsp;                    photo.setDescr(cursor.getString(cursor.getColumnIndexOrThrow(DbHelper.PHOTO_DESCR)))</b>
<b class="nc">&nbsp;                    photos.add(photo)</b>
<b class="nc">&nbsp;                } while (cursor.moveToNext())</b>
&nbsp;                cursor.close()
&nbsp;            }
&nbsp;        } catch (e: Exception) {
<b class="nc">&nbsp;            Log.e(TAG, &quot;Failed to get photos for trigpoint&quot;, e)</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            db.close()</b>
&nbsp;        }
<b class="nc">&nbsp;        return photos</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-08-25 13:52</div>
</div>
</body>
</html>
