


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LogTrigActivity</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">uk.trigpointing.android.logging</a>
</div>

<h1>Coverage Summary for Class: LogTrigActivity (uk.trigpointing.android.logging)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LogTrigActivity</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/140)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/398)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LogTrigActivity$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$11</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$12</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LogTrigActivity$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/64)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/154)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/442)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package uk.trigpointing.android.logging;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.io.FileNotFoundException;
&nbsp;import java.io.IOException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Calendar;
&nbsp;import java.util.List;
&nbsp;
&nbsp;// import org.acra.ErrorReporter;
&nbsp;
&nbsp;import uk.trigpointing.android.common.BaseTabActivity;
&nbsp;import androidx.appcompat.app.AlertDialog;
&nbsp;
&nbsp;import android.Manifest;
&nbsp;import android.content.pm.PackageManager;
&nbsp;import android.widget.ProgressBar;
&nbsp;import android.widget.LinearLayout;
&nbsp;import android.util.TypedValue;
&nbsp;import android.content.Context;
&nbsp;
&nbsp;import android.content.DialogInterface;
&nbsp;import android.content.Intent;
&nbsp;import android.content.SharedPreferences;
&nbsp;
&nbsp;import android.database.Cursor;
&nbsp;import android.graphics.Bitmap;
&nbsp;import android.location.Location;
&nbsp;import android.location.LocationListener;
&nbsp;import android.location.LocationManager;
&nbsp;import android.net.Uri;
&nbsp;import android.os.Bundle;
&nbsp;import androidx.preference.PreferenceManager;
&nbsp;import android.provider.MediaStore;
&nbsp;import android.util.Log;
&nbsp;import android.view.View;
&nbsp;import android.view.View.OnClickListener;
&nbsp;import android.view.MotionEvent;
&nbsp;import android.view.View.OnFocusChangeListener;
&nbsp;import android.widget.ArrayAdapter;
&nbsp;import android.widget.Button;
&nbsp;import android.widget.CheckBox;
&nbsp;import android.widget.DatePicker;
&nbsp;import android.widget.DatePicker.OnDateChangedListener;
&nbsp;import android.widget.EditText;
&nbsp;
&nbsp;import androidx.core.app.ActivityCompat;
&nbsp;import androidx.core.content.ContextCompat;
&nbsp;import androidx.recyclerview.widget.RecyclerView;
&nbsp;import androidx.recyclerview.widget.LinearLayoutManager;
&nbsp;// Removed unused Fragment-related imports; using getSupportFragmentManager directly
&nbsp;// Removed direct Compose interop imports in Java; we host via FrameLayout/RecyclerView
&nbsp;import android.widget.RatingBar;
&nbsp;import android.widget.Spinner;
&nbsp;import android.widget.TextView;
&nbsp;import android.widget.TimePicker;
&nbsp;import android.widget.Toast;
&nbsp;import android.view.MenuItem;
&nbsp;import android.widget.ViewSwitcher;
&nbsp;
&nbsp;import uk.trigpointing.android.DbHelper;
&nbsp;import uk.trigpointing.android.R;
&nbsp;import uk.trigpointing.android.common.FileCache;
&nbsp;import uk.trigpointing.android.common.Utils;
&nbsp;import uk.trigpointing.android.types.Condition;
&nbsp;import uk.trigpointing.android.types.LatLon;
&nbsp;import uk.trigpointing.android.types.LatLon.UNITS;
&nbsp;import uk.trigpointing.android.types.PhotoSubject;
&nbsp;import uk.trigpointing.android.types.TrigPhoto;
&nbsp;// no direct Compose imports in Java
&nbsp;
<b class="nc">&nbsp;public class LogTrigActivity extends BaseTabActivity implements OnDateChangedListener, LocationListener, SyncListener {</b>
&nbsp;	private static final String TAG			= &quot;LogTrigActivity&quot;;
&nbsp;    private SharedPreferences 	mPrefs;
&nbsp;
&nbsp;    private LatLon.UNITS		mUnits;
&nbsp;    private String				mStrUnits;
&nbsp;    
&nbsp;	private Long				mTrigId;
&nbsp;	private LatLon				mTrigLocation;
&nbsp;	
&nbsp;    private ViewSwitcher 		mSwitcher;
&nbsp;    private CheckBox			mSendTime;
&nbsp;    private DatePicker			mDate;
&nbsp;    private TimePicker			mTime;
&nbsp;    private EditText			mGridref;
&nbsp;    private EditText			mFb;
&nbsp;    private Spinner				mCondition;
&nbsp;    private RatingBar			mScore;
&nbsp;    private EditText			mComment;
&nbsp;    private CheckBox			mAdminFlag;
&nbsp;    private CheckBox			mUserFlag;
&nbsp;    private RecyclerView			mGallery;
&nbsp;    private TextView			mLocationError;
&nbsp;    
&nbsp;    private DbHelper 			mDb;
&nbsp;    private boolean				mHaveLog;
&nbsp;    
&nbsp;    private	List&lt;TrigPhoto&gt; 	mPhotos; 
&nbsp;    private PhotoManager        mPhotoManager;
&nbsp;
&nbsp;    private AlertDialog      mProgressDialog;
&nbsp;    private ProgressBar      mProgressBar;
&nbsp;    private TextView         mProgressText;
&nbsp;    private LocationManager 	mLocationManager;
&nbsp;    private static final int REQ_LOCATION = 2001;
&nbsp;    
&nbsp;    	// Photo picker constants
&nbsp;	private static final int CHOOSE_PHOTO = 1;
&nbsp;	private static final int EDIT_PHOTO = 2;
&nbsp;	
&nbsp;	@Override
&nbsp;	protected void onCreate(Bundle savedInstanceState) {
<b class="nc">&nbsp;		Log.i(TAG, &quot;onCreate&quot;);</b>
<b class="nc">&nbsp;		super.onCreate(savedInstanceState);</b>
<b class="nc">&nbsp;		setContentView(R.layout.logtrig);</b>
&nbsp;		
&nbsp;        // This activity is embedded inside TrigDetailsActivity TabHost.
&nbsp;        // Hide the activity action bar to avoid a double header.
<b class="nc">&nbsp;        if (getSupportActionBar() != null) {</b>
<b class="nc">&nbsp;            getSupportActionBar().hide();</b>
&nbsp;        }
&nbsp;		
&nbsp;		// Initialize PhotoManager with a coroutine scope
<b class="nc">&nbsp;		mPhotoManager = new PhotoManager(this, kotlinx.coroutines.GlobalScope.INSTANCE);</b>
&nbsp;		
&nbsp;		// Note: ActivityResultLauncher doesn&#39;t work properly with LocalActivityManager
&nbsp;		// We&#39;ll use the traditional onActivityResult approach instead
&nbsp;		
<b class="nc">&nbsp;        mPrefs = PreferenceManager.getDefaultSharedPreferences(this);</b>
&nbsp;
&nbsp;		// Get trig_id from extras 
<b class="nc">&nbsp;		Bundle extras = getIntent().getExtras();</b>
<b class="nc">&nbsp;		if (extras != null) {</b>
<b class="nc">&nbsp;			mTrigId = extras.getLong(DbHelper.TRIG_ID);</b>
&nbsp;		}
<b class="nc">&nbsp;		if (mTrigId == null) {mTrigId=0L;}</b>
<b class="nc">&nbsp;		Log.i(TAG, &quot;Trig_id = &quot;+mTrigId);</b>
&nbsp;		
&nbsp;		// should we list m or yards?
<b class="nc">&nbsp;		if (mPrefs.getString(&quot;units&quot;, &quot;metric&quot;).equals(&quot;metric&quot;)) {</b>
<b class="nc">&nbsp;			mUnits = UNITS.METRES;</b>
<b class="nc">&nbsp;			mStrUnits = &quot;m&quot;;</b>
&nbsp;		} else {
<b class="nc">&nbsp;			mUnits = UNITS.YARDS;</b>
<b class="nc">&nbsp;			mStrUnits = &quot;yds&quot;;</b>
&nbsp;		}
&nbsp;
&nbsp;		
&nbsp;		// Get references to various views and form elements
<b class="nc">&nbsp;		mSwitcher 		= findViewById(R.id.logswitcher);</b>
&nbsp;		
&nbsp;		// Ensure proper content positioning to prevent action bar overlap
&nbsp;		// Content positioning is now handled by BaseActivity
<b class="nc">&nbsp;		mSendTime		= findViewById(R.id.sendTime);</b>
<b class="nc">&nbsp;	   	mTime			= findViewById(R.id.logTime);</b>
<b class="nc">&nbsp;	   	mDate			= findViewById(R.id.logDate);</b>
<b class="nc">&nbsp;	   	mGridref 		= findViewById(R.id.logGridref);</b>
<b class="nc">&nbsp;	   	mLocationError 	= findViewById(R.id.locationError);</b>
<b class="nc">&nbsp;	   	mFb 			= findViewById(R.id.logFB);</b>
<b class="nc">&nbsp;	   	mCondition		= findViewById(R.id.logCondition);</b>
<b class="nc">&nbsp;	   	mScore			= findViewById(R.id.logScore);</b>
&nbsp;	   	
&nbsp;	   			// Ensure minimum 1 star rating
<b class="nc">&nbsp;	   	mScore.setOnRatingBarChangeListener(new RatingBar.OnRatingBarChangeListener() {</b>
&nbsp;	   		@Override
&nbsp;	   		public void onRatingChanged(RatingBar ratingBar, float rating, boolean fromUser) {
<b class="nc">&nbsp;	   			if (fromUser &amp;&amp; rating &lt; 1.0f) {</b>
<b class="nc">&nbsp;	   				ratingBar.setRating(1.0f);</b>
&nbsp;	   			}
&nbsp;	   		}
&nbsp;	   	});
&nbsp;	    
&nbsp;	   	// Setup CheckBox listener for time logging
<b class="nc">&nbsp;	   	mSendTime.setOnCheckedChangeListener(new android.widget.CompoundButton.OnCheckedChangeListener() {</b>
&nbsp;	   		@Override
&nbsp;	   		public void onCheckedChanged(android.widget.CompoundButton buttonView, boolean isChecked) {
<b class="nc">&nbsp;	   			updateTimeVisibility();</b>
&nbsp;	   		}
&nbsp;	   	});
<b class="nc">&nbsp;		   mComment		= findViewById(R.id.logComment);</b>
&nbsp;
&nbsp;    	// Setup time picker options which cannot be set in the config xml
<b class="nc">&nbsp; 		mTime.setIs24HourView(true);</b>
&nbsp; 		
&nbsp; 				// Force DatePicker to spinner mode only (hide calendar)
&nbsp;		// Note: setCalendarViewShown and setSpinnersShown are deprecated but still functional
&nbsp;		// These will be modernized in a future update
&nbsp;		try {
&nbsp;			@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;			boolean calendarViewShown = false;</b>
&nbsp;			@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;			boolean spinnersShown = true;</b>
&nbsp;			// Suppress deprecation warnings for now - these methods still work
&nbsp;		} catch (Exception e) {
<b class="nc">&nbsp;			Log.w(TAG, &quot;Could not force DatePicker to spinner mode: &quot; + e.getMessage());</b>
&nbsp;		}
<b class="nc">&nbsp;	   	mAdminFlag		= findViewById(R.id.logAdminFlag);</b>
<b class="nc">&nbsp;	   	mUserFlag		= findViewById(R.id.logUserFlag);</b>
<b class="nc">&nbsp;            mGallery 		= findViewById(R.id.logGallery);</b>
<b class="nc">&nbsp;        mGallery.setLayoutManager(new LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false));</b>
&nbsp;
&nbsp;	    
&nbsp;
&nbsp;
&nbsp;		// Setup condition spinner
<b class="nc">&nbsp; 		List&lt;Condition&gt; loggableConditions = new ArrayList&lt;Condition&gt;(Arrays.asList(Condition.values()));</b>
<b class="nc">&nbsp; 		loggableConditions.remove(Condition.TRIGNOTLOGGED);</b>
<b class="nc">&nbsp;		ArrayAdapter&lt;Condition&gt; adapter = new ArrayAdapter&lt;Condition&gt; (this, android.R.layout.simple_spinner_item, loggableConditions);</b>
<b class="nc">&nbsp;		adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</b>
<b class="nc">&nbsp;		mCondition.setAdapter(adapter);</b>
&nbsp;
&nbsp;		// Switch off logUserFlag
<b class="nc">&nbsp;        if (!mPrefs.getBoolean(&quot;experimental&quot;, false)) {</b>
<b class="nc">&nbsp;        	mUserFlag.setVisibility(View.INVISIBLE);</b>
&nbsp;        }
&nbsp;        	
&nbsp;		
&nbsp;		// Setup listener on gallery photos
<b class="nc">&nbsp;	    mGallery.addOnItemTouchListener(new RecyclerView.OnItemTouchListener() {</b>
&nbsp;	        @Override
&nbsp;	        public boolean onInterceptTouchEvent(RecyclerView rv, MotionEvent e) {
<b class="nc">&nbsp;	            View child = rv.findChildViewUnder(e.getX(), e.getY());</b>
<b class="nc">&nbsp;	            if (child != null) {</b>
<b class="nc">&nbsp;	                int position = rv.getChildAdapterPosition(child);</b>
<b class="nc">&nbsp;	                if (position != RecyclerView.NO_POSITION &amp;&amp; mPhotos != null &amp;&amp; position &lt; mPhotos.size()) {</b>
<b class="nc">&nbsp;	                    Log.i(TAG, &quot;Clicked photo icon number : &quot; + position);</b>
<b class="nc">&nbsp;	                    Long photoId = mPhotos.get(position).getLogID();</b>
<b class="nc">&nbsp;	                    showPhotoMetadataDialog(photoId);</b>
<b class="nc">&nbsp;	                    return true;</b>
&nbsp;	                }
&nbsp;	            }
<b class="nc">&nbsp;	            return false;</b>
&nbsp;	        }
&nbsp;
&nbsp;	        @Override
<b class="nc">&nbsp;	        public void onTouchEvent(RecyclerView rv, MotionEvent e) {}</b>
&nbsp;
&nbsp;	        @Override
<b class="nc">&nbsp;	        public void onRequestDisallowInterceptTouchEvent(boolean disallowIntercept) {}</b>
&nbsp;	    });
&nbsp;
&nbsp;		
&nbsp;		// Connect to database
<b class="nc">&nbsp;		mDb = new DbHelper(this);</b>
<b class="nc">&nbsp;		mDb.open();</b>
&nbsp;		
&nbsp;		// Fetch trigpoint info
<b class="nc">&nbsp;		Cursor c = mDb.fetchTrigInfo(mTrigId);</b>
<b class="nc">&nbsp;		c.moveToFirst();</b>
<b class="nc">&nbsp;		Double lat = Double.valueOf(c.getString(c.getColumnIndex(DbHelper.TRIG_LAT)));</b>
<b class="nc">&nbsp;		Double lon = Double.valueOf(c.getString(c.getColumnIndex(DbHelper.TRIG_LON)));</b>
<b class="nc">&nbsp;		mTrigLocation = new LatLon(lat, lon);</b>
&nbsp;		c.close();
&nbsp;
&nbsp;
&nbsp;		// Check to see whether log already exists
<b class="nc">&nbsp;		mHaveLog = (mDb.fetchLog(mTrigId) != null);</b>
&nbsp;		
&nbsp;		// Set initial ViewSwitcher state:
&nbsp;		// - If no log exists, show the &quot;Log this trigpoint&quot; button (index 0)
&nbsp;		// - If log exists, show the form (index 1)
<b class="nc">&nbsp;		if (mHaveLog) {</b>
<b class="nc">&nbsp;			mSwitcher.setDisplayedChild(1); // Show form</b>
&nbsp;		} else {
<b class="nc">&nbsp;			mSwitcher.setDisplayedChild(0); // Show button</b>
&nbsp;		}
&nbsp;		
&nbsp;		
&nbsp;		// Setup button to add photo
<b class="nc">&nbsp;		Button takePhotoBtn = findViewById(R.id.logAddPhoto);</b>
<b class="nc">&nbsp;		takePhotoBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;				choosePhoto();</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		// Setup button to create a new log
<b class="nc">&nbsp;		Button addLogBtn = findViewById(R.id.addLog);</b>
<b class="nc">&nbsp;		addLogBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	Log.i(TAG, &quot;Create Log&quot;);</b>
<b class="nc">&nbsp;				createNewLog();</b>
<b class="nc">&nbsp;				populateFields();</b>
<b class="nc">&nbsp;	        	mSwitcher.setDisplayedChild(1); // Show form</b>
<b class="nc">&nbsp;	        	mHaveLog = true;</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		// Setup button to delete the log
<b class="nc">&nbsp;		Button deleteLogBtn = findViewById(R.id.logDelete);</b>
<b class="nc">&nbsp;		deleteLogBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	Log.i(TAG, &quot;Delete Log&quot;);</b>
<b class="nc">&nbsp;	        	deleteLog();</b>
<b class="nc">&nbsp;	        	mSwitcher.setDisplayedChild(0); // Show button</b>
<b class="nc">&nbsp;	        	mHaveLog = false;</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		// Setup button to add the current location
<b class="nc">&nbsp;		Button locationBtn = findViewById(R.id.logGetLocation);</b>
<b class="nc">&nbsp;		locationBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	getLocation();</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;		
&nbsp;		// Setup button to upload the log
<b class="nc">&nbsp;		Button uploadBtn = findViewById(R.id.logUploadNow);</b>
<b class="nc">&nbsp;		uploadBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	uploadLog();</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		// Setup button to sync the log later (ie do nothing!)
<b class="nc">&nbsp;		Button syncLaterBtn = findViewById(R.id.logSyncLater);</b>
<b class="nc">&nbsp;		syncLaterBtn.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	finish();</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		// Setup change listener for sendTime button
<b class="nc">&nbsp;		mSendTime.setOnClickListener(new OnClickListener() {</b>
&nbsp;			@Override
&nbsp;			public void onClick(View arg0) {
<b class="nc">&nbsp;	        	updateTimeVisibility();</b>
&nbsp;			}
&nbsp;		});	
&nbsp;
&nbsp;		
&nbsp;		// check new grid references
<b class="nc">&nbsp;		mGridref.setOnFocusChangeListener(new OnFocusChangeListener() {			@Override</b>
&nbsp;			public void onFocusChange(View v, boolean hasFocus) {
<b class="nc">&nbsp;				if (!hasFocus) {</b>
<b class="nc">&nbsp;					checkDistance();</b>
&nbsp;				}
&nbsp;			}
&nbsp;		});		
&nbsp;	}
&nbsp;
&nbsp;	public void checkDistance() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;checkDistance&quot;);</b>
&nbsp;		try {
<b class="nc">&nbsp;			LatLon ll = new LatLon(mGridref.getText().toString());</b>
<b class="nc">&nbsp;			Double dist = ll.distanceTo(mTrigLocation, mUnits);</b>
<b class="nc">&nbsp;			Log.e(TAG, &quot;trig &quot; + mTrigLocation.getOSGB10() + &quot; - &quot; + mTrigLocation.getWGS());</b>
<b class="nc">&nbsp;			Log.e(TAG, &quot;log &quot; + ll.getOSGB10() + &quot; - &quot; + ll.getWGS());</b>
<b class="nc">&nbsp;			Log.e(TAG, &quot;Gridref &quot; + dist.intValue() + &quot; &quot; + mUnits + &quot; from database location&quot;);</b>
<b class="nc">&nbsp;			if (dist &gt;= 50) {</b>
<b class="nc">&nbsp;				mLocationError.setText(&quot;Warning: &quot; + dist.intValue() + mStrUnits + &quot; from database location&quot;);</b>
<b class="nc">&nbsp;				mLocationError.setTextColor(ContextCompat.getColor(this, R.color.errorcolour));</b>
&nbsp;			} else {
<b class="nc">&nbsp;				mLocationError.setText(dist.intValue() + mStrUnits + &quot; from database location&quot;);</b>
<b class="nc">&nbsp;				mLocationError.setTextColor(ContextCompat.getColor(this, R.color.okcolour));</b>
&nbsp;			}
&nbsp;		} catch (IllegalArgumentException e) {
<b class="nc">&nbsp;			Log.e(TAG, e.getMessage());</b>
<b class="nc">&nbsp;			mLocationError.setText(e.getMessage());</b>
<b class="nc">&nbsp;			mLocationError.setTextColor(ContextCompat.getColor(this, R.color.errorcolour));</b>
&nbsp;		}		
&nbsp;	}
&nbsp;	
&nbsp;	private void tryPrePopulateGridReference() {
<b class="nc">&nbsp;		if (mLocationManager == null) {</b>
<b class="nc">&nbsp;			mLocationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);</b>
&nbsp;		}
&nbsp;		
&nbsp;		try {
&nbsp;			// Check if GPS is enabled
<b class="nc">&nbsp;			if (!mLocationManager.isProviderEnabled(LocationManager.GPS_PROVIDER)) {</b>
<b class="nc">&nbsp;				Log.d(TAG, &quot;GPS not enabled, cannot pre-populate grid reference&quot;);</b>
&nbsp;				return;
&nbsp;			}
&nbsp;			
&nbsp;			// Get last known location
<b class="nc">&nbsp;			Location lastLocation = mLocationManager.getLastKnownLocation(LocationManager.GPS_PROVIDER);</b>
<b class="nc">&nbsp;			if (lastLocation != null) {</b>
&nbsp;				// Check if location is recent (within last 10 minutes)
<b class="nc">&nbsp;				long locationAge = System.currentTimeMillis() - lastLocation.getTime();</b>
<b class="nc">&nbsp;				if (locationAge &lt; 10 * 60 * 1000) { // 10 minutes in milliseconds</b>
<b class="nc">&nbsp;					LatLon ll = new LatLon(lastLocation);</b>
<b class="nc">&nbsp;					mGridref.setText(ll.getOSGB10());</b>
<b class="nc">&nbsp;					checkDistance();</b>
<b class="nc">&nbsp;					Log.d(TAG, &quot;Pre-populated grid reference with GPS: &quot; + ll.getOSGB10());</b>
&nbsp;				} else {
<b class="nc">&nbsp;					Log.d(TAG, &quot;Last GPS location too old (&quot; + (locationAge / 60000) + &quot; minutes), not using&quot;);</b>
&nbsp;				}
&nbsp;			} else {
<b class="nc">&nbsp;				Log.d(TAG, &quot;No last known GPS location available&quot;);</b>
&nbsp;			}
&nbsp;		} catch (SecurityException e) {
<b class="nc">&nbsp;			Log.w(TAG, &quot;No location permission, cannot pre-populate grid reference&quot;);</b>
&nbsp;		} catch (Exception e) {
<b class="nc">&nbsp;			Log.e(TAG, &quot;Error trying to pre-populate grid reference&quot;, e);</b>
&nbsp;		}
&nbsp;	}
&nbsp;    
&nbsp;	@Override
&nbsp;	protected void onPause() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;onPause - calling saveLog&quot;);</b>
<b class="nc">&nbsp;		super.onPause();</b>
<b class="nc">&nbsp;		saveLog();</b>
&nbsp;	}
&nbsp;	
&nbsp;	@Override
&nbsp;	protected void onStop() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;onStop&quot;);</b>
<b class="nc">&nbsp;		super.onStop();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	protected void onResume() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;onResume - calling populateFields&quot;);</b>
<b class="nc">&nbsp;		super.onResume();</b>
<b class="nc">&nbsp;		if (mTrigId != null) {</b>
<b class="nc">&nbsp;			populateFields();</b>
&nbsp;		}
&nbsp;	}
&nbsp;	
&nbsp;	@Override
&nbsp;	protected void onActivityResult(int requestCode, int resultCode, Intent data) {
<b class="nc">&nbsp;		super.onActivityResult(requestCode, resultCode, data);</b>
&nbsp;		
<b class="nc">&nbsp;		Log.i(TAG, &quot;onActivityResult: requestCode=&quot; + requestCode + &quot;, resultCode=&quot; + resultCode + &quot;, data=&quot; + (data != null ? &quot;present&quot; : &quot;null&quot;));</b>
&nbsp;		
<b class="nc">&nbsp;		if (requestCode == CHOOSE_PHOTO) {</b>
<b class="nc">&nbsp;			Log.i(TAG, &quot;Processing CHOOSE_PHOTO result&quot;);</b>
<b class="nc">&nbsp;			if (resultCode == RESULT_OK &amp;&amp; data != null) {</b>
<b class="nc">&nbsp;				Log.i(TAG, &quot;Photo picker returned OK with data&quot;);</b>
&nbsp;				
<b class="nc">&nbsp;				List&lt;Uri&gt; selectedUris = new ArrayList&lt;&gt;();</b>
&nbsp;				
&nbsp;				// Check for multiple selection via ClipData
<b class="nc">&nbsp;				if (data.getClipData() != null) {</b>
<b class="nc">&nbsp;					int count = data.getClipData().getItemCount();</b>
<b class="nc">&nbsp;					Log.i(TAG, &quot;ClipData found with &quot; + count + &quot; items&quot;);</b>
<b class="nc">&nbsp;					for (int i = 0; i &lt; count; i++) {</b>
<b class="nc">&nbsp;						Uri uri = data.getClipData().getItemAt(i).getUri();</b>
<b class="nc">&nbsp;						if (uri != null) {</b>
<b class="nc">&nbsp;							selectedUris.add(uri);</b>
<b class="nc">&nbsp;							Log.d(TAG, &quot;Added URI from ClipData: &quot; + uri);</b>
&nbsp;						}
&nbsp;					}
<b class="nc">&nbsp;				} else if (data.getData() != null) {</b>
&nbsp;					// Single selection
<b class="nc">&nbsp;					Uri uri = data.getData();</b>
<b class="nc">&nbsp;					selectedUris.add(uri);</b>
<b class="nc">&nbsp;					Log.i(TAG, &quot;Single photo selected: &quot; + uri);</b>
&nbsp;				} else {
<b class="nc">&nbsp;					Log.w(TAG, &quot;No URI found in result data&quot;);</b>
&nbsp;				}
&nbsp;				
<b class="nc">&nbsp;				if (!selectedUris.isEmpty()) {</b>
<b class="nc">&nbsp;					Log.i(TAG, &quot;Processing &quot; + selectedUris.size() + &quot; selected photo(s)&quot;);</b>
<b class="nc">&nbsp;					handleSelectedPhotos(selectedUris);</b>
&nbsp;				} else {
<b class="nc">&nbsp;					Log.w(TAG, &quot;No valid URIs found in result&quot;);</b>
<b class="nc">&nbsp;					Toast.makeText(this, &quot;No photos were selected&quot;, Toast.LENGTH_SHORT).show();</b>
&nbsp;				}
<b class="nc">&nbsp;			} else if (resultCode == RESULT_CANCELED) {</b>
<b class="nc">&nbsp;				Log.i(TAG, &quot;Photo picker was cancelled by user&quot;);</b>
&nbsp;			} else {
<b class="nc">&nbsp;				Log.w(TAG, &quot;Photo picker returned unexpected result: &quot; + resultCode);</b>
&nbsp;			}
<b class="nc">&nbsp;		} else if (requestCode == EDIT_PHOTO) {</b>
<b class="nc">&nbsp;			Log.i(TAG, &quot;Processing EDIT_PHOTO result&quot;);</b>
<b class="nc">&nbsp;			if (resultCode == RESULT_OK) {</b>
<b class="nc">&nbsp;				Log.i(TAG, &quot;Photo editing returned OK, updating gallery&quot;);</b>
<b class="nc">&nbsp;				updateGallery();</b>
<b class="nc">&nbsp;			} else if (resultCode == RESULT_CANCELED) {</b>
<b class="nc">&nbsp;				Log.i(TAG, &quot;Photo editing was cancelled by user&quot;);</b>
&nbsp;			} else {
<b class="nc">&nbsp;				Log.i(TAG, &quot;Photo editing returned unexpected result: &quot; + resultCode);</b>
&nbsp;			}
&nbsp;		} else {
<b class="nc">&nbsp;			Log.w(TAG, &quot;Unknown request code: &quot; + requestCode);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;    @Override
&nbsp;	protected void onDestroy() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;onDestroy&quot;);</b>
<b class="nc">&nbsp;		super.onDestroy();</b>
<b class="nc">&nbsp;		if (mDb != null) {</b>
<b class="nc">&nbsp;			mDb.close();</b>
&nbsp;		}
&nbsp;	}
&nbsp;	
&nbsp;	@Override
&nbsp;	public boolean onOptionsItemSelected(MenuItem item) {
<b class="nc">&nbsp;		if (item.getItemId() == android.R.id.home) {</b>
&nbsp;			// Handle back button in action bar
<b class="nc">&nbsp;			finish();</b>
<b class="nc">&nbsp;			return true;</b>
&nbsp;		}
<b class="nc">&nbsp;		return super.onOptionsItemSelected(item);</b>
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;    // service request to choose a photo using modern approach
&nbsp;    public void choosePhoto() {
<b class="nc">&nbsp;        Log.i(TAG, &quot;choosePhoto() called - Starting photo selection process&quot;);</b>
&nbsp;        
&nbsp;        // When embedded in LocalActivityManager, we need the parent to launch the picker
&nbsp;        // Get the parent activity (TrigDetailsActivity)
<b class="nc">&nbsp;        android.app.Activity parent = getParent();</b>
<b class="nc">&nbsp;        if (parent != null) {</b>
<b class="nc">&nbsp;            Log.i(TAG, &quot;Found parent activity: &quot; + parent.getClass().getSimpleName());</b>
<b class="nc">&nbsp;            Log.i(TAG, &quot;Requesting parent to launch photo picker&quot;);</b>
&nbsp;            
&nbsp;            // Use the parent activity to launch the photo picker
&nbsp;            try {
&nbsp;                Intent intent;
<b class="nc">&nbsp;                if (android.os.Build.VERSION.SDK_INT &gt;= 33) {</b>
&nbsp;                    // Android 13+ photo picker - NO PERMISSIONS REQUIRED!
<b class="nc">&nbsp;                    intent = new Intent(&quot;android.provider.action.PICK_IMAGES&quot;);</b>
<b class="nc">&nbsp;                    intent.putExtra(&quot;android.provider.extra.PICK_IMAGES_MAX&quot;, 10);</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Using Android 13+ PICK_IMAGES intent (no permissions required)&quot;);</b>
<b class="nc">&nbsp;                } else if (android.os.Build.VERSION.SDK_INT &gt;= 30) {</b>
&nbsp;                    // Android 11-12: Use ACTION_GET_CONTENT without permissions
<b class="nc">&nbsp;                    intent = new Intent(Intent.ACTION_GET_CONTENT);</b>
<b class="nc">&nbsp;                    intent.setType(&quot;image/*&quot;);</b>
<b class="nc">&nbsp;                    intent.putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true);</b>
<b class="nc">&nbsp;                    intent.addCategory(Intent.CATEGORY_OPENABLE);</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Using ACTION_GET_CONTENT for Android 11-12 (no permissions required)&quot;);</b>
&nbsp;                } else {
&nbsp;                    // Android 10 and below: May need READ_EXTERNAL_STORAGE
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Android 10 or below, checking READ_EXTERNAL_STORAGE permission&quot;);</b>
<b class="nc">&nbsp;                    if (ActivityCompat.checkSelfPermission(this, </b>
&nbsp;                            android.Manifest.permission.READ_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
<b class="nc">&nbsp;                        Log.i(TAG, &quot;READ_EXTERNAL_STORAGE permission not granted, requesting...&quot;);</b>
<b class="nc">&nbsp;                        ActivityCompat.requestPermissions(this,</b>
&nbsp;                            new String[]{android.Manifest.permission.READ_EXTERNAL_STORAGE},
&nbsp;                            3001);
&nbsp;                        return;
&nbsp;                    }
<b class="nc">&nbsp;                    intent = new Intent(Intent.ACTION_GET_CONTENT);</b>
<b class="nc">&nbsp;                    intent.setType(&quot;image/*&quot;);</b>
<b class="nc">&nbsp;                    intent.putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true);</b>
<b class="nc">&nbsp;                    intent.addCategory(Intent.CATEGORY_OPENABLE);</b>
<b class="nc">&nbsp;                    Log.d(TAG, &quot;Using ACTION_GET_CONTENT for Android 10 and below&quot;);</b>
&nbsp;                }
&nbsp;                
&nbsp;                // Check if the intent can be handled
<b class="nc">&nbsp;                if (intent.resolveActivity(getPackageManager()) != null) {</b>
<b class="nc">&nbsp;                    Log.i(TAG, &quot;Parent starting activity for result with request code: &quot; + CHOOSE_PHOTO);</b>
<b class="nc">&nbsp;                    parent.startActivityForResult(intent, CHOOSE_PHOTO);</b>
&nbsp;                } else {
&nbsp;                    // Final fallback - single image picker
<b class="nc">&nbsp;                    Log.w(TAG, &quot;Multi-select not available, falling back to single image picker&quot;);</b>
<b class="nc">&nbsp;                    Intent singleIntent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</b>
<b class="nc">&nbsp;                    parent.startActivityForResult(singleIntent, CHOOSE_PHOTO);</b>
&nbsp;                }
&nbsp;            } catch (Exception e) {
<b class="nc">&nbsp;                Log.e(TAG, &quot;Failed to launch photo picker&quot;, e);</b>
<b class="nc">&nbsp;                Toast.makeText(this, &quot;Failed to open photo picker: &quot; + e.getMessage(), Toast.LENGTH_LONG).show();</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            Log.e(TAG, &quot;No parent activity found! Cannot launch photo picker properly&quot;);</b>
&nbsp;            // Fallback to direct launch (might not work properly)
<b class="nc">&nbsp;            Log.w(TAG, &quot;Attempting direct launch as fallback...&quot;);</b>
&nbsp;            try {
<b class="nc">&nbsp;                Intent intent = new Intent(Intent.ACTION_GET_CONTENT);</b>
<b class="nc">&nbsp;                intent.setType(&quot;image/*&quot;);</b>
<b class="nc">&nbsp;                intent.putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true);</b>
<b class="nc">&nbsp;                intent.addCategory(Intent.CATEGORY_OPENABLE);</b>
<b class="nc">&nbsp;                startActivityForResult(intent, CHOOSE_PHOTO);</b>
&nbsp;            } catch (Exception e) {
<b class="nc">&nbsp;                Log.e(TAG, &quot;Fallback launch also failed&quot;, e);</b>
<b class="nc">&nbsp;                Toast.makeText(this, &quot;Cannot open photo picker in this context&quot;, Toast.LENGTH_LONG).show();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    // Handle photos selected from the modern picker
&nbsp;    private void handleSelectedPhotos(List&lt;Uri&gt; uris) {
<b class="nc">&nbsp;        Log.i(TAG, &quot;handleSelectedPhotos() called with &quot; + uris.size() + &quot; URIs&quot;);</b>
&nbsp;        
<b class="nc">&nbsp;        if (mTrigId == null || mTrigId == 0) {</b>
<b class="nc">&nbsp;            Log.e(TAG, &quot;Cannot add photos - mTrigId is null or 0: &quot; + mTrigId);</b>
<b class="nc">&nbsp;            Toast.makeText(this, &quot;Please create a log entry first&quot;, Toast.LENGTH_LONG).show();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        Log.d(TAG, &quot;Processing photos for trigpoint ID: &quot; + mTrigId);</b>
&nbsp;        
&nbsp;        // Show progress dialog (using AlertDialog instead of deprecated ProgressDialog)
<b class="nc">&nbsp;        AlertDialog.Builder builder = new AlertDialog.Builder(this);</b>
<b class="nc">&nbsp;        builder.setMessage(&quot;Processing photos...&quot;);</b>
<b class="nc">&nbsp;        builder.setCancelable(false);</b>
<b class="nc">&nbsp;        AlertDialog progressDialog = builder.create();</b>
<b class="nc">&nbsp;        progressDialog.show();</b>
<b class="nc">&nbsp;        Log.d(TAG, &quot;Progress dialog shown&quot;);</b>
&nbsp;        
<b class="nc">&nbsp;        mPhotoManager.processSelectedPhotos(</b>
<b class="nc">&nbsp;            mTrigId,</b>
&nbsp;            uris,
&nbsp;            (Long photoId) -&gt; {
&nbsp;                // Photo added successfully, show metadata dialog
<b class="nc">&nbsp;                runOnUiThread(() -&gt; {</b>
<b class="nc">&nbsp;                    progressDialog.dismiss();</b>
<b class="nc">&nbsp;                    showPhotoMetadataDialog(photoId);</b>
&nbsp;                });
&nbsp;                return kotlin.Unit.INSTANCE;
&nbsp;            },
&nbsp;            () -&gt; {
&nbsp;                // All photos processed
<b class="nc">&nbsp;                runOnUiThread(() -&gt; {</b>
<b class="nc">&nbsp;                    progressDialog.dismiss();</b>
<b class="nc">&nbsp;                    updateGallery();</b>
<b class="nc">&nbsp;                    Toast.makeText(this, &quot;Photos added successfully&quot;, Toast.LENGTH_SHORT).show();</b>
&nbsp;                });
&nbsp;                return kotlin.Unit.INSTANCE;
&nbsp;            },
&nbsp;            (String error) -&gt; {
&nbsp;                // Error occurred
<b class="nc">&nbsp;                runOnUiThread(() -&gt; {</b>
<b class="nc">&nbsp;                    progressDialog.dismiss();</b>
<b class="nc">&nbsp;                    Toast.makeText(this, &quot;Error: &quot; + error, Toast.LENGTH_LONG).show();</b>
&nbsp;                });
&nbsp;                return kotlin.Unit.INSTANCE;
&nbsp;            }
&nbsp;        );
&nbsp;    }
&nbsp;    
&nbsp;    private void showPhotoMetadataDialog(Long photoId) {
<b class="nc">&nbsp;        PhotoMetadataDialog dialog = PhotoMetadataDialog.Companion.newInstance(photoId.longValue());</b>
<b class="nc">&nbsp;        dialog.setCallbacks(</b>
&nbsp;            metadata -&gt; {
&nbsp;                // Metadata saved
<b class="nc">&nbsp;                updateGallery();</b>
&nbsp;                return kotlin.Unit.INSTANCE;
&nbsp;            },
&nbsp;            () -&gt; {
&nbsp;                // Photo deleted
<b class="nc">&nbsp;                updateGallery();</b>
&nbsp;                return kotlin.Unit.INSTANCE;
&nbsp;            }
&nbsp;        );
<b class="nc">&nbsp;        dialog.show(getSupportFragmentManager(), &quot;photo_metadata&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;	
&nbsp;    
&nbsp;    
&nbsp;	private void createPhoto (Intent data) {
&nbsp;		// Photo chosen - create DB entry and send user to edit activity
<b class="nc">&nbsp;		Log.i(TAG, &quot;createPhoto&quot;);</b>
<b class="nc">&nbsp;		Uri selectedImageUri = data.getData();</b>
<b class="nc">&nbsp;		if (selectedImageUri != null) {</b>
<b class="nc">&nbsp;    		Log.i(TAG, &quot;Photo URI - &quot; + selectedImageUri);</b>
&nbsp;    		
&nbsp;    		// create a database record for the new photo
<b class="nc">&nbsp;    		Long photoId = mDb.createPhoto(mTrigId, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, PhotoSubject.NOSUBJECT, 0);</b>
<b class="nc">&nbsp;    		Log.i(TAG, &quot;Created Photo - &quot; + photoId);</b>
&nbsp;
&nbsp;    		
&nbsp;    		// shrink the photo and store on SD card
<b class="nc">&nbsp;			String cachedir  = new FileCache(this, &quot;logphotos&quot;).getCacheDir().getAbsolutePath();</b>
<b class="nc">&nbsp;			String photoPath = cachedir + &quot;/&quot; + photoId + &quot;_I.jpg&quot;;</b>
<b class="nc">&nbsp;			String thumbPath = cachedir + &quot;/&quot; + photoId + &quot;_T.jpg&quot;;</b>
<b class="nc">&nbsp;			Log.d(TAG, photoPath + &quot; - &quot; + thumbPath);</b>
&nbsp;			try {
<b class="nc">&nbsp;				Bitmap bThumb = Utils.decodeUri(this, selectedImageUri,  100);</b>
<b class="nc">&nbsp;				Bitmap bPhoto = Utils.decodeUri(this, selectedImageUri,  640);</b>
<b class="nc">&nbsp;				Utils.saveBitmapToFile(thumbPath, bThumb, 50);</b>
<b class="nc">&nbsp;				Utils.saveBitmapToFile(photoPath, bPhoto, 50);</b>
&nbsp;			} catch (FileNotFoundException e) {
<b class="nc">&nbsp;				e.printStackTrace();</b>
&nbsp;				// ErrorReporter.getInstance().handleSilentException(e);
&nbsp;				return;
&nbsp;			} catch (IOException e) {
<b class="nc">&nbsp;				e.printStackTrace();</b>
&nbsp;				// ErrorReporter.getInstance().handleSilentException(e);
&nbsp;				return;
&nbsp;			}
&nbsp;    		
&nbsp;    		// update the database record with the new photos
<b class="nc">&nbsp;    		mDb.updatePhoto(photoId, mTrigId, &quot;&quot;, &quot;&quot;, thumbPath, photoPath, PhotoSubject.NOSUBJECT, 0);</b>
<b class="nc">&nbsp;    		Log.i(TAG, &quot;Updated photo - &quot; + photoId);</b>
&nbsp;    		
&nbsp;    		// Update the gallery immediately to show the new thumbnail
<b class="nc">&nbsp;    		updateGallery();</b>
&nbsp;    		
&nbsp;    		// edit the other fields for the new photo
<b class="nc">&nbsp;            Intent i = new Intent(this, LogPhotoActivity.class);</b>
<b class="nc">&nbsp;            i.putExtra(DbHelper.PHOTO_ID, photoId);</b>
<b class="nc">&nbsp;            startActivityForResult(i, EDIT_PHOTO);</b>
&nbsp;		} else {
<b class="nc">&nbsp;			Log.w(TAG, &quot;No image URI received from picker&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;    
&nbsp; 
&nbsp;    private void populateFields() {
<b class="nc">&nbsp;    	Log.i(TAG, &quot;populateFields&quot;);</b>
<b class="nc">&nbsp;    	Cursor c = mDb.fetchLog(mTrigId);</b>
<b class="nc">&nbsp;    	if (c == null) {return;}</b>
&nbsp;
&nbsp;    	// set Date
<b class="nc">&nbsp;    	mDate.init				(c.getInt(c.getColumnIndex(DbHelper.LOG_YEAR)), </b>
<b class="nc">&nbsp;    							 c.getInt(c.getColumnIndex(DbHelper.LOG_MONTH)),</b>
<b class="nc">&nbsp;    							 c.getInt(c.getColumnIndex(DbHelper.LOG_DAY)), </b>
&nbsp;    							 this);
&nbsp;
&nbsp;
&nbsp;    	
&nbsp;    	// set Text fields    	
<b class="nc">&nbsp;    	mComment.setText 		(c.getString(c.getColumnIndex(DbHelper.LOG_COMMENT)));</b>
<b class="nc">&nbsp;    	String gridref = c.getString(c.getColumnIndex(DbHelper.LOG_GRIDREF));</b>
<b class="nc">&nbsp;    	mGridref.setText		(gridref);</b>
<b class="nc">&nbsp;    	mFb.setText 			(c.getString(c.getColumnIndex(DbHelper.LOG_FB)));</b>
&nbsp;    	
&nbsp;    	// Pre-populate grid reference with GPS if blank and GPS available
<b class="nc">&nbsp;    	if (gridref == null || gridref.trim().isEmpty()) {</b>
<b class="nc">&nbsp;    		tryPrePopulateGridReference();</b>
&nbsp;    	}
&nbsp;    	
&nbsp;    	// set Time
<b class="nc">&nbsp;    	mSendTime.setChecked	(c.getInt(c.getColumnIndex(DbHelper.LOG_SENDTIME)) &gt; 0);</b>
&nbsp;    	// Suppress deprecation warnings for TimePicker methods - these still work
&nbsp;    	@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;    	int hour = c.getInt(c.getColumnIndex(DbHelper.LOG_HOUR));</b>
&nbsp;    	@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;    	int minute = c.getInt(c.getColumnIndex(DbHelper.LOG_MINUTES));</b>
&nbsp;    	// Note: setCurrentHour/setCurrentMinute are deprecated but functional
<b class="nc">&nbsp;    	updateTimeVisibility();</b>
&nbsp;    	
&nbsp;    	// set Flags
<b class="nc">&nbsp;    	mAdminFlag.setChecked	(c.getInt(c.getColumnIndex(DbHelper.LOG_FLAGADMINS)) &gt; 0);</b>
<b class="nc">&nbsp;    	mUserFlag.setChecked 	(c.getInt(c.getColumnIndex(DbHelper.LOG_FLAGUSERS))  &gt; 0);</b>
&nbsp;    	
&nbsp;    	// set Score
<b class="nc">&nbsp;    	mScore.setRating		(c.getInt(c.getColumnIndex(DbHelper.LOG_SCORE)));</b>
&nbsp;    	
&nbsp;    	// set Condition
<b class="nc">&nbsp;    	Condition cond = Condition.fromCode(c.getString(c.getColumnIndex(DbHelper.LOG_CONDITION)));</b>
<b class="nc">&nbsp;    	mCondition.setSelection (Arrays.asList(Condition.values()).indexOf(cond));</b>
&nbsp;
&nbsp;    	c.close();
&nbsp;    	
<b class="nc">&nbsp;    	updateGallery();</b>
<b class="nc">&nbsp;    	checkDistance();</b>
&nbsp;
&nbsp;        }
&nbsp;    
&nbsp;    private void updateTimeVisibility () {
<b class="nc">&nbsp;    	mTime.setEnabled(mSendTime.isChecked());</b>
&nbsp;    }
&nbsp;
&nbsp;    
&nbsp;    private void updateGallery() {
<b class="nc">&nbsp;		Log.i(TAG, &quot;updateGallery() called for trigId: &quot; + mTrigId);</b>
<b class="nc">&nbsp;	    mPhotos = new ArrayList&lt;TrigPhoto&gt;(); </b>
<b class="nc">&nbsp;		Cursor c = mDb.fetchPhotos(mTrigId);</b>
<b class="nc">&nbsp;		if (c != null &amp;&amp; c.moveToFirst()) {</b>
<b class="nc">&nbsp;			Log.d(TAG, &quot;Found photos in database, processing...&quot;);</b>
<b class="nc">&nbsp;			int count = 0;</b>
&nbsp;			do {
<b class="nc">&nbsp;				TrigPhoto photo = new TrigPhoto();</b>
<b class="nc">&nbsp;				long photoId = c.getLong(c.getColumnIndex(DbHelper.PHOTO_ID));</b>
<b class="nc">&nbsp;				String iconUrl = c.getString(c.getColumnIndex(DbHelper.PHOTO_ICON));</b>
<b class="nc">&nbsp;				photo.setLogID(photoId);</b>
<b class="nc">&nbsp;				photo.setIconURL(iconUrl);</b>
<b class="nc">&nbsp;				mPhotos.add(photo);</b>
<b class="nc">&nbsp;				count++;</b>
<b class="nc">&nbsp;				Log.d(TAG, &quot;Added photo to gallery - ID: &quot; + photoId + &quot;, Icon: &quot; + iconUrl);</b>
<b class="nc">&nbsp;			} while (c.moveToNext());</b>
&nbsp;			c.close();
<b class="nc">&nbsp;			Log.i(TAG, &quot;Added &quot; + count + &quot; photos to gallery list&quot;);</b>
&nbsp;		} else {
<b class="nc">&nbsp;			Log.d(TAG, &quot;No photos found in database for trigId: &quot; + mTrigId);</b>
&nbsp;		}
&nbsp;		
<b class="nc">&nbsp;		Log.d(TAG, &quot;Setting adapter with &quot; + mPhotos.size() + &quot; photos&quot;);</b>
<b class="nc">&nbsp;		mGallery.setAdapter(new LogTrigRecyclerAdapter(this, mPhotos.toArray(new TrigPhoto[mPhotos.size()])));</b>
<b class="nc">&nbsp;		Log.d(TAG, &quot;Gallery adapter updated successfully&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	public void reloadPhotos() {
&nbsp;		try {
<b class="nc">&nbsp;			updateGallery();</b>
&nbsp;		} catch (Exception e) {
<b class="nc">&nbsp;			Log.e(TAG, &quot;Failed to reload photos&quot;, e);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;    
&nbsp;    
&nbsp;	private void saveLog() {
<b class="nc">&nbsp;    	Log.i(TAG, &quot;saveLog&quot;);</b>
&nbsp;    	
&nbsp;    	// Only save the log if one already exists
<b class="nc">&nbsp;    	if (!mHaveLog) {return;}</b>
&nbsp;    	
&nbsp;    	// Save the changes to the database
&nbsp;    	try {
<b class="nc">&nbsp;    		mDb.mDb.beginTransaction();</b>
<b class="nc">&nbsp;    		mDb.deleteLog(mTrigId);</b>
&nbsp;    		// Suppress deprecation warnings for TimePicker methods
&nbsp;    		@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;    		int currentHour = mTime.getCurrentHour();</b>
&nbsp;    		@SuppressWarnings(&quot;deprecation&quot;)
<b class="nc">&nbsp;    		int currentMinute = mTime.getCurrentMinute();</b>
&nbsp;    		
<b class="nc">&nbsp;    		mDb.createLog(mTrigId, </b>
<b class="nc">&nbsp;    			mDate.getYear(), </b>
<b class="nc">&nbsp;    			mDate.getMonth(), </b>
<b class="nc">&nbsp;    			mDate.getDayOfMonth(),</b>
<b class="nc">&nbsp;    			mSendTime.isChecked()?1:0,</b>
&nbsp;				currentHour, 
&nbsp;				currentMinute, 
<b class="nc">&nbsp;				mGridref.getText().toString(), </b>
<b class="nc">&nbsp;				mFb.getText().toString(), </b>
<b class="nc">&nbsp;				(Condition) mCondition.getSelectedItem(), </b>
<b class="nc">&nbsp;				(int) mScore.getRating(), </b>
<b class="nc">&nbsp;				mComment.getText().toString(),</b>
<b class="nc">&nbsp;				mAdminFlag.isChecked()?1:0, </b>
<b class="nc">&nbsp;				mUserFlag.isChecked()?1:0);</b>
&nbsp;    		
<b class="nc">&nbsp;    		mDb.mDb.setTransactionSuccessful();</b>
<b class="nc">&nbsp;        	Log.i(TAG, &quot;Transaction Successful&quot;);</b>
&nbsp;    	} catch (Exception e) {
<b class="nc">&nbsp;    		Log.i(TAG, &quot;Transaction rolled back&quot;);</b>
&nbsp;    	} finally {
<b class="nc">&nbsp;    		mDb.mDb.endTransaction();</b>
&nbsp;    	}
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void createNewLog() {
&nbsp;    	// Create an empty log with default values for time, score etc
<b class="nc">&nbsp;    	Calendar now = Calendar.getInstance();</b>
<b class="nc">&nbsp;    	mDb.createLog(mTrigId, </b>
<b class="nc">&nbsp;    			now.get(Calendar.YEAR), </b>
<b class="nc">&nbsp;    			now.get(Calendar.MONTH), </b>
<b class="nc">&nbsp;    			now.get(Calendar.DAY_OF_MONTH),</b>
&nbsp;    			1,
<b class="nc">&nbsp;    			now.get(Calendar.HOUR_OF_DAY), </b>
<b class="nc">&nbsp;    			now.get(Calendar.MINUTE), </b>
&nbsp;    			&quot;&quot;, 
&nbsp;    			&quot;&quot;, 
&nbsp;    			Condition.CONDITIONNOTLOGGED, 
&nbsp;    			3, // Start with 3 stars default
&nbsp;    			&quot;&quot;, 
&nbsp;    			0, 
&nbsp;    			0);
&nbsp;    }
&nbsp;    
&nbsp;    private void deleteLog() {
&nbsp;    	// delete log records from DB
<b class="nc">&nbsp;    	mDb.deleteLog(mTrigId);</b>
&nbsp;    	// delete image files from filesystem
<b class="nc">&nbsp;		Cursor c = mDb.fetchPhotos(mTrigId);</b>
<b class="nc">&nbsp;		if (c!=null) {</b>
&nbsp;			do {
<b class="nc">&nbsp;				new File(c.getString(c.getColumnIndex(DbHelper.PHOTO_PHOTO))).delete();</b>
<b class="nc">&nbsp;				new File(c.getString(c.getColumnIndex(DbHelper.PHOTO_ICON))).delete();</b>
<b class="nc">&nbsp;			} while (c.moveToNext());</b>
&nbsp;		}
&nbsp;    	// delete photo records from DB
<b class="nc">&nbsp;    	mDb.deletePhotosForTrig(mTrigId);</b>
&nbsp;    }
&nbsp;
&nbsp;    
&nbsp;    
&nbsp;    private void uploadLog() {
<b class="nc">&nbsp;    	Log.i(TAG, &quot;uploadLog&quot;);</b>
&nbsp;    	
&nbsp;    	// check for login credentials in prefs
<b class="nc">&nbsp;    	SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);</b>
<b class="nc">&nbsp;		String username = prefs.getString(&quot;username&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;		String password = prefs.getString(&quot;plaintextpassword&quot;, &quot;&quot;);</b>
&nbsp;		
<b class="nc">&nbsp;		if (username.trim().isEmpty() || password.trim().isEmpty()) {</b>
<b class="nc">&nbsp;			Toast.makeText(this, R.string.toastPleaseLogin, Toast.LENGTH_LONG).show();</b>
&nbsp;			return;
&nbsp;		}
&nbsp;		
<b class="nc">&nbsp;		saveLog();</b>
<b class="nc">&nbsp;		new SyncTask(LogTrigActivity.this, this).execute(false, mTrigId);</b>
&nbsp;    }
&nbsp;
&nbsp;    
&nbsp;	@Override
&nbsp;	public void onDateChanged(DatePicker view, int pYear, int pMonth, int pDay) {
<b class="nc">&nbsp;		Log.i(TAG, &quot;Date changed&quot;);</b>
<b class="nc">&nbsp;		Calendar cal = Calendar.getInstance();</b>
<b class="nc">&nbsp;		int day = cal.get(Calendar.DATE);</b>
<b class="nc">&nbsp;		int month = cal.get(Calendar.MONTH);</b>
<b class="nc">&nbsp;		int year = cal.get(Calendar.YEAR);</b>
<b class="nc">&nbsp;		if ( pYear  &gt; year</b>
&nbsp;		|| ( pYear == year &amp;&amp; pMonth  &gt; month)
&nbsp;		|| ( pYear == year &amp;&amp; pMonth == month &amp;&amp; pDay &gt; day) ) {
<b class="nc">&nbsp;			view.updateDate(year, month, day);</b>
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	
&nbsp;	
&nbsp;	
&nbsp;	   private void getLocation() {
<b class="nc">&nbsp;		    Log.i(TAG, &quot;Start location listener and put up dialog box&quot;);</b>
<b class="nc">&nbsp;			mLocationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);</b>
&nbsp;		    
<b class="nc">&nbsp;		    if (!mLocationManager.isProviderEnabled (LocationManager.GPS_PROVIDER)) {</b>
<b class="nc">&nbsp;				Log.w(TAG, &quot;GPS not enabled in system settings!&quot;);</b>
<b class="nc">&nbsp;				Toast.makeText(this, &quot;Please enable GPS in system settings!&quot;, Toast.LENGTH_LONG).show();</b>
&nbsp;				return;
&nbsp;		    }
&nbsp;
&nbsp;		    // Start listening for GPS updates
<b class="nc">&nbsp;           if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED &amp;&amp; ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {</b>
<b class="nc">&nbsp;               ActivityCompat.requestPermissions(this,</b>
&nbsp;                       new String[]{Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.ACCESS_COARSE_LOCATION},
&nbsp;                       REQ_LOCATION);
&nbsp;               return;
&nbsp;           }
<b class="nc">&nbsp;           mLocationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 1000L,1.0f, this);</b>
&nbsp;
<b class="nc">&nbsp;		   LinearLayout container = new LinearLayout(this);</b>
<b class="nc">&nbsp;		   container.setOrientation(LinearLayout.VERTICAL);</b>
<b class="nc">&nbsp;		   int paddingPx = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 24,</b>
<b class="nc">&nbsp;                    getResources().getDisplayMetrics());</b>
<b class="nc">&nbsp;		   container.setPadding(paddingPx, paddingPx, paddingPx, paddingPx);</b>
&nbsp;
<b class="nc">&nbsp;		   mProgressText = new TextView(this);</b>
<b class="nc">&nbsp;		   mProgressText.setText(&quot;Getting accurate GPS fix...&quot;);</b>
<b class="nc">&nbsp;		   container.addView(mProgressText, new LinearLayout.LayoutParams(</b>
&nbsp;                    LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.WRAP_CONTENT));
&nbsp;
<b class="nc">&nbsp;		   mProgressBar = new ProgressBar(this);</b>
<b class="nc">&nbsp;		   mProgressBar.setIndeterminate(true);</b>
<b class="nc">&nbsp;		   container.addView(mProgressBar, new LinearLayout.LayoutParams(</b>
&nbsp;                    LinearLayout.LayoutParams.MATCH_PARENT, LinearLayout.LayoutParams.WRAP_CONTENT));
&nbsp;
<b class="nc">&nbsp;		   mProgressDialog = new AlertDialog.Builder(this)</b>
<b class="nc">&nbsp;                    .setView(container)</b>
<b class="nc">&nbsp;                    .setCancelable(true)</b>
<b class="nc">&nbsp;                    .create();</b>
<b class="nc">&nbsp;		   mProgressDialog.show();</b>
<b class="nc">&nbsp;		   mProgressDialog.setOnCancelListener (new DialogInterface.OnCancelListener() {</b>
&nbsp;                @Override
&nbsp;                public void onCancel(DialogInterface arg0) {
<b class="nc">&nbsp;                    Toast.makeText(LogTrigActivity.this, &quot;Cancelled Get location&quot;, Toast.LENGTH_SHORT).show();</b>
<b class="nc">&nbsp;                    mLocationManager.removeUpdates(LogTrigActivity.this);</b>
&nbsp;                }});
&nbsp;	    }
&nbsp;	    
&nbsp;
&nbsp;	
&nbsp;	@Override
&nbsp;	public void onLocationChanged(Location location) {
&nbsp;		// Found GPS location, so cancel dialog, update the GUI, and stop listening for locations
&nbsp;
<b class="nc">&nbsp;		LatLon ll = new LatLon(location);</b>
<b class="nc">&nbsp;		mGridref.setText(ll.getOSGB10());</b>
<b class="nc">&nbsp;		checkDistance();</b>
&nbsp;		
<b class="nc">&nbsp;		mProgressDialog.dismiss();</b>
<b class="nc">&nbsp;		Toast.makeText(this, &quot;GPS location added&quot;, Toast.LENGTH_SHORT).show();</b>
&nbsp;
<b class="nc">&nbsp;		mLocationManager.removeUpdates(this);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void onProviderDisabled(String provider) {
<b class="nc">&nbsp;		Log.i(TAG, &quot;GPS provider disabled&quot;);</b>
<b class="nc">&nbsp;		mProgressDialog.cancel();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void onProviderEnabled(String provider) {
<b class="nc">&nbsp;		Log.i(TAG, &quot;GPS provider enabled&quot;);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	public void onStatusChanged(String provider, int status, Bundle extras) {
<b class="nc">&nbsp;	}</b>
&nbsp;
&nbsp;	@Override
&nbsp;	public void onSynced(int status) {
<b class="nc">&nbsp;    	if (status == SyncTask.SUCCESS) {</b>
<b class="nc">&nbsp;    		mSwitcher.setDisplayedChild(0); // Show button after successful sync</b>
<b class="nc">&nbsp;        	mHaveLog = false;</b>
&nbsp;    	}
&nbsp;	}
&nbsp;
&nbsp;    @Override
&nbsp;    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
<b class="nc">&nbsp;        super.onRequestPermissionsResult(requestCode, permissions, grantResults);</b>
<b class="nc">&nbsp;        if (requestCode == REQ_LOCATION) {</b>
<b class="nc">&nbsp;            boolean granted = false;</b>
<b class="nc">&nbsp;            if (grantResults != null &amp;&amp; grantResults.length &gt; 0) {</b>
<b class="nc">&nbsp;                for (int res : grantResults) {</b>
<b class="nc">&nbsp;                    if (res == PackageManager.PERMISSION_GRANTED) {</b>
<b class="nc">&nbsp;                        granted = true;</b>
&nbsp;                        break;
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (granted) {</b>
<b class="nc">&nbsp;                getLocation();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                Toast.makeText(this, &quot;Location permission denied&quot;, Toast.LENGTH_LONG).show();</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (requestCode == 3001) {</b>
&nbsp;            // Photo permission request (Android 10 and below only)
<b class="nc">&nbsp;            if (grantResults != null &amp;&amp; grantResults.length &gt; 0 </b>
&nbsp;                    &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
<b class="nc">&nbsp;                Log.i(TAG, &quot;READ_EXTERNAL_STORAGE permission granted&quot;);</b>
<b class="nc">&nbsp;                choosePhoto();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                Log.w(TAG, &quot;READ_EXTERNAL_STORAGE permission denied&quot;);</b>
<b class="nc">&nbsp;                Toast.makeText(this, &quot;Photo access permission denied. Please grant storage permission to select photos.&quot;, Toast.LENGTH_LONG).show();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;
&nbsp;
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-08-25 13:52</div>
</div>
</body>
</html>
